var Mt=Object.defineProperty;var $t=Object.getOwnPropertyDescriptor;var Ht=Object.getOwnPropertyNames;var Kt=Object.prototype.hasOwnProperty;var Ce=(p=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(p,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):p)(function(p){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+p+'" is not supported')});var Q=(p,e)=>()=>(p&&(e=p(p=0)),e);var vt=(p,e)=>{for(var t in e)Mt(p,t,{get:e[t],enumerable:!0})},Wt=(p,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ht(e))!Kt.call(p,n)&&n!==t&&Mt(p,n,{get:()=>e[n],enumerable:!(i=$t(e,n))||i.enumerable});return p};var Rt=p=>Wt(Mt({},"__esModule",{value:!0}),p);var Dt={};vt(Dt,{CanonicalNameUtils:()=>Nt,canonFqn:()=>Pt,canonKey:()=>N,canonMethod:()=>Ft,ensureFqn:()=>T});function T(p){let e=String(p||"");return e.startsWith("\\")?e:"\\"+e}function Pt(p){let t=String(p||"").replace(/[\u200B-\u200D\uFEFF]/g,"").trim().replace(/\\+$/,"");return(t.startsWith("\\")?t:"\\"+t).replace(/\\\\+/g,"\\").toLowerCase()}function Ft(p){return String(p||"").replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\s+/g,"").replace(/\(\)$/,"").trim().toLowerCase()}function N(p,e){return`${Pt(p)}::${Ft(e)}`}var Nt,R=Q(()=>{"use strict";Nt=class{static{this.ensureFqn=T}static{this.canonFqn=Pt}static{this.canonMethod=Ft}static{this.canonKey=N}}});var k,I,S,Ae,H=Q(()=>{"use strict";k={ADDED:"A",DELETED:"D",MODIFIED:"M",RENAMED:"R",COPIED:"C"},I={NEW_FILE:"new file mode",DELETED_FILE:"deleted file mode",BLOCK_MARKER:"@@",OR_OPERATOR:"||"},S={ADDITION:"+",REMOVAL:"-",ADDITION_FILE:"+++",REMOVAL_FILE:"---",CONTEXT:" "},Ae={CONTEXT_LINES:10}});var P,b,Te,Tn,X=Q(()=>{"use strict";P={PHP:".php",XML:".xml",YML:".yml",YAML:".yaml",JSON:".json",TWIG:".twig",JS:".js",TS:".ts",SCSS:".scss",CSS:".css",MARKDOWN:".md",TEXT:".txt",CSV:".csv"},b={CONFIG:"Config.php",COMPOSER_JSON:"composer.json",CONFIG_FILE:"config.",INTERFACE_SUFFIX:"Interface",SCHEMA_XML:".schema.xml",TRANSFER_XML:".transfer.xml",TEST_DIRECTORY:/\/tests?\//i},Te=[P.XML,P.YML,P.YAML,P.JSON,P.TWIG,P.JS,P.TS,P.SCSS,P.CSS,P.MARKDOWN,P.TEXT,P.CSV],Tn=[P.TWIG,P.JS,P.TS,P.SCSS,P.CSS]});var h,Ee,K,_,kt,W=Q(()=>{"use strict";h={NEW:"new",MODIFIED:"modified",REMOVED:"removed",ADDED:"added",DELETED:"deleted",NONE:"none"},Ee={IMPLEMENTATION:"implementation",SIGNATURE:"signature"},K={ADDED:"added",REMOVED:"removed",UPGRADED:"upgraded",DOWNGRADED:"downgraded",UNCHANGED:"unchanged"},_={MAJOR:"major",MINOR:"minor",PATCH:"patch",RELAXED:"relaxed",TIGHTENED:"tightened",UNCHANGED:"unchanged"},kt={STRICT_ADDED:"strictAdded",STRICT_REMOVED:"strictRemoved",PROPERTY_ADDED:"propertyAdded",PROPERTY_REMOVED:"propertyRemoved",PROPERTY_MODIFIED:"propertyModified"}});var D,Ie,w,J,V,Z=Q(()=>{"use strict";D={METHOD_SIGNATURE:/^\s*(?:public|protected|private)?\s*(?:static\s+)?function\s+(\w+)/,DIFF_METHOD_SIGNATURE:/^([+ -])\s*(public|protected|private)\s+(?:static\s+)?function\s+(\w+)\s*\(/,VISIBILITY_MODIFIER:/^\s*(public|protected|private)/,CLOSING_BRACE:/^\s*}\s*$/,CLASS_NAME:/class\s+(\w+)/,NAMESPACE:/namespace\s+([\w\\]+)/,CLASS_NAME_FROM_PATH:/\/([^\/]+)\.php$/},Ie={TRANSFER_OPEN:/<transfer\s+name="([^"]+)"/g,TRANSFER_CLOSE:"</transfer>",PROPERTY_OPEN:/<property\s+name="([^"]+)"/g},w={COLUMN:"<column name=",INDEX:"<index",INDEX_NAME:"<index name=",INDEX_CLOSE:"</index>",INDEX_COLUMN:"<index-column name=",TABLE:"<table name="},J={STRICT:"strict=",TRUE_VALUE:"true"},V={REQUIRE:"require",REQUIRE_DEV:"require-dev",PHP:"php"}});function Re(){return`(${te.join("|")})$`}var At,xe,oe,le,Tt,z,U,ee,be,te,ne,De,$=Q(()=>{"use strict";At={SPRYKER:"Spryker",SPRYKER_SHOP:"SprykerShop",SPRYKER_FEATURE:"SprykerFeature"},xe=[At.SPRYKER,At.SPRYKER_SHOP,At.SPRYKER_FEATURE],oe={ZED:"Zed",CLIENT:"Client",SERVICE:"Service",GLUE:"Glue",YVES:"Yves",SHARED:"Shared"},le=[oe.ZED,oe.CLIENT,oe.SERVICE,oe.GLUE,oe.YVES,oe.SHARED],Tt={BUSINESS:"Business",COMMUNICATION:"Communication",PERSISTENCE:"Persistence"},z=[Tt.BUSINESS,Tt.COMMUNICATION,Tt.PERSISTENCE],U={CONTROLLER:"Controller",FORM:"Form",TABLE:"Table"},ee={NAMESPACE:"\\",PATH:"/"},be={FACADE:"Facade",CLIENT:"Client",SERVICE:"Service",PLUGIN:"Plugin"},te=[be.FACADE,be.CLIENT,be.SERVICE,be.PLUGIN],ne={PLUGIN:/\\Plugin\\|Plugin$/,SPRYKER_FILE_PATH:/src\/(Spryker(?:Shop|Feature)?)\/(Zed|Client|Service|Glue|Yves|Shared)\/([^\/]+)\/(.+)\.php$/};De=[{detect:"/Bundles/",glob:"Bundles/{module}/src/**/*.php"},{detect:"/Features/",glob:"Features/{module}/src/**/*.php"}]});var O,G,Se=Q(()=>{"use strict";O={HIGH:{level:"HIGH",emoji:"\u{1F534}"},MEDIUM:{level:"MEDIUM",emoji:"\u{1F7E1}"},LOW:{level:"LOW",emoji:"\u{1F7E2}"}},G={MODIFIED_CONFIG_METHODS_HIGH:3,NEW_PUBLIC_API_MEDIUM:5,INTERNAL_WITH_IMPACT_MEDIUM:10}});var L,he=Q(()=>{"use strict";L={MAJOR:"MAJOR",MINOR:"MINOR",PATCH:"PATCH"}});var M,F,Et=Q(()=>{"use strict";M={METHOD:"method",PLUGIN:"plugin",CLASS:"class",CONSTANT:"constant",TRANSFER:"transfer",SCHEMA:"schema",COMPOSER:"composer",CONFIG:"config"},F={ADDED:"added",REMOVED:"removed",MODIFIED:"modified",IMPROVED:"improved",ADJUSTED:"adjusted",DEPRECATED:"deprecated"}});var Ot={};vt(Ot,{AnalyzerConfig:()=>E});var E,ie=Q(()=>{"use strict";H();X();W();Z();$();Se();he();Et();E=class{static{this.gitStatus={...k,added:k.ADDED,deleted:k.DELETED,modified:k.MODIFIED,renamed:k.RENAMED,copied:k.COPIED}}static{this.fileExtensions=P}static{this.patterns={methodSignature:D.METHOD_SIGNATURE,diffMethodSignature:D.DIFF_METHOD_SIGNATURE,visibilityModifier:D.VISIBILITY_MODIFIER,closingBrace:D.CLOSING_BRACE,className:D.CLASS_NAME,namespace:D.NAMESPACE,classNameFromPath:D.CLASS_NAME_FROM_PATH,testDirectory:b.TEST_DIRECTORY,transferSchema:new RegExp(b.TRANSFER_XML.replace(/\./g,"\\.")),sprykerFilePath:ne.SPRYKER_FILE_PATH}}static{this.spryker={vendors:xe,layers:le,namespaceSeparator:ee.NAMESPACE,pathSeparator:ee.PATH,publicApiClassSuffixes:te,publicApiPatterns:{plugin:ne.PLUGIN},internalApiLayers:z,communicationLayerClasses:{...U,controller:U.CONTROLLER,form:U.FORM,table:U.TABLE}}}static{this.phpKeywords={static:"static"}}static{this.filePatterns={composerJson:b.COMPOSER_JSON,config:b.CONFIG,configFile:b.CONFIG_FILE,schemaXml:b.SCHEMA_XML,interfaceSuffix:b.INTERFACE_SUFFIX,phpExtension:P.PHP,yamlExt:".yml",yamlExtAlt:".yaml"}}static{this.changeTypes={...h,new:h.NEW,modified:h.MODIFIED,removed:h.REMOVED,added:h.ADDED,deleted:h.DELETED,none:h.NONE}}static{this.internalChangeTypes=Ee}static{this.versionChangeTypes=K}static{this.constraintChangeTypes=_}static{this.transferChangeTypes=kt}static{this.composerKeys=V}static{this.schemaTags={...w,table:w.TABLE,column:w.COLUMN,index:w.INDEX,indexName:w.INDEX_NAME,indexClose:w.INDEX_CLOSE,indexColumn:w.INDEX_COLUMN}}static{this.xmlAttributes={...J,strict:J.STRICT,trueValue:J.TRUE_VALUE}}static{this.xmlPatterns=Ie}static{this.diffMarkers={...I,newFile:I.NEW_FILE,deletedFile:I.DELETED_FILE,blockMarker:I.BLOCK_MARKER,orOperator:I.OR_OPERATOR}}static{this.diffPrefixes=S}static{this.diffPrefixChars={added:S.ADDITION,removed:S.REMOVAL,unchanged:S.CONTEXT,addition:S.ADDITION,removal:S.REMOVAL,additionFileMarker:S.ADDITION_FILE,removalFileMarker:S.REMOVAL_FILE}}static{this.diffSettings=Ae}static{this.defaultModulePatterns=De}static{this.relevantNonPhpExtensions=Te}static{this.riskLevels={...O,high:O.HIGH,medium:O.MEDIUM,low:O.LOW}}static{this.riskThresholds={...G,modifiedConfigMethodsHigh:G.MODIFIED_CONFIG_METHODS_HIGH,newPublicAPIMedium:G.NEW_PUBLIC_API_MEDIUM,internalWithImpactMedium:G.INTERNAL_WITH_IMPACT_MEDIUM}}static{this.versionBumpTypes={...L,major:L.MAJOR,minor:L.MINOR,patch:L.PATCH}}static{this.changelogTypes={...M,method:M.METHOD,plugin:M.PLUGIN,class:M.CLASS,constant:M.CONSTANT,transfer:M.TRANSFER,schema:M.SCHEMA,composer:M.COMPOSER,config:M.CONFIG}}static{this.changelogActions={...F,added:F.ADDED,removed:F.REMOVED,modified:F.MODIFIED,improved:F.IMPROVED,adjusted:F.ADJUSTED,deprecated:F.DEPRECATED}}static{this.visibility={public:"public",protected:"protected",private:"private"}}static{this.visibilityModifiers={public:"public",protected:"protected",private:"private"}}static{this.diffBlockMarker=I.BLOCK_MARKER}static{this.skipReasons={emptyDiff:"Empty diff",noClassName:"No class name found",unknownError:"Unknown error"}}static{this.getEntrypointPattern=Re}}});var Xt={};vt(Xt,{ChangelogFormatter:()=>It});var It,Jt=Q(()=>{"use strict";W();Et();Se();he();It=class{format(e,t){let i=new Map;for(let[r,s]of t){let a=this.formatModuleChangelog(s);i.set(r,a)}let n=this.generateSummary(i);return{modules:i,summary:n}}formatModuleChangelog(e){let t=[],i=[],n=[],r=[];for(let l of e.publicApiChanges.removedMethods)t.push({type:M.METHOD,action:F.REMOVED,item:this.extractMethodName(l.method),file:l.file,context:l.description||l.isApiMethod||l.isDeprecated?{description:l.description,isApiMethod:l.isApiMethod,isDeprecated:l.isDeprecated}:void 0});for(let l of e.publicApiChanges.modifiedMethods)l.signatureChanged&&t.push({type:M.METHOD,action:F.MODIFIED,item:this.extractMethodName(l.method),signatureChanged:!0,file:l.file,context:l.description||l.isApiMethod||l.isDeprecated?{description:l.description,isApiMethod:l.isApiMethod,isDeprecated:l.isDeprecated}:void 0});for(let l of e.publicApiChanges.affectedByInternal)i.push({type:M.METHOD,action:F.IMPROVED,item:this.extractMethodName(l.method),context:l.description||l.isApiMethod||l.isDeprecated?{description:l.description,isApiMethod:l.isApiMethod,isDeprecated:l.isDeprecated}:void 0});for(let l of e.publicApiChanges.newMethods)i.push({type:M.METHOD,action:F.ADDED,item:this.extractMethodName(l.method),visibility:l.visibility,file:l.file,context:l.description||l.isApiMethod||l.isDeprecated?{description:l.description,isApiMethod:l.isApiMethod,isDeprecated:l.isDeprecated}:void 0});for(let l of e.configChanges.newMethods)i.push({type:M.CONFIG,action:F.ADDED,item:this.extractMethodName(l.method),visibility:l.visibility,file:l.file});for(let l of e.pluginChanges.affectedByInternal)i.push({type:M.PLUGIN,action:F.IMPROVED,item:this.extractClassName(l.method)});for(let l of e.pluginChanges.newPluginClasses)i.push({type:M.PLUGIN,action:F.ADDED,item:l.name,file:l.file});for(let l of e.pluginChanges.newPlugins)i.push({type:M.METHOD,action:F.ADDED,item:this.extractMethodName(l.method),visibility:l.visibility,file:l.file,pluginClass:this.extractClassName(l.method)});for(let l of e.pluginChanges.deprecatedPluginClasses)r.push({type:M.PLUGIN,action:F.DEPRECATED,item:l.name,file:l.file});for(let l of e.constantChanges.removedConstants){let m={type:M.CONSTANT,action:F.REMOVED,item:`${l.className}::${l.name}`,oldValue:l.value,visibility:l.visibility};l.isConfigOrConstants?t.push(m):n.push(m)}for(let l of e.dataChanges.schemas){if(l.addedColumns&&l.addedColumns.length>0)for(let m of l.addedColumns)i.push({type:M.SCHEMA,action:F.ADDED,item:`${l.tableName}.${m.name}`,newValue:m.type});if(l.addedIndexes&&l.addedIndexes.length>0)for(let m of l.addedIndexes)i.push({type:M.SCHEMA,action:F.ADDED,item:`${l.tableName}.${m.name}`,columns:m.columns})}let s=new Set,a=new Map;for(let l of e.communicationChanges.adjustedMethods){let m=this.extractClassName(l.method);m.endsWith("Controller")?n.push({type:M.METHOD,action:F.ADJUSTED,item:this.extractMethodName(l.method),file:l.file}):(s.add(m),a.has(m)||a.set(m,l.file))}for(let l of s)n.push({type:M.CLASS,action:F.ADJUSTED,item:l,file:a.get(l)});if(e.composerChanges)for(let l of e.composerChanges.dependencyChanges)n.push({type:M.COMPOSER,action:F.MODIFIED,item:l.package,oldValue:l.oldConstraint,newValue:l.newConstraint});for(let l of e.dataChanges.schemas)if(l.modifiedColumns&&l.modifiedColumns.length>0)for(let m of l.modifiedColumns)n.push({type:M.SCHEMA,action:F.MODIFIED,item:`${l.tableName}.${m.name}`,oldValue:m.oldType,newValue:m.newType});let o=[];for(let l of e.dataChanges.transfers){if(l.changeType===h.NEW){o.push({type:M.TRANSFER,action:F.ADDED,item:l.name});continue}if(l.addedProperties&&l.addedProperties.length>0)for(let m of l.addedProperties)i.push({type:M.TRANSFER,action:F.ADDED,item:`${l.name}.${m}`});if(l.modifiedProperties&&l.modifiedProperties.length>0)for(let m of l.modifiedProperties)n.push({type:M.TRANSFER,action:F.MODIFIED,item:`${l.name}.${m}`})}if(e.internalChanges){for(let l of e.internalChanges.newMethods)n.push({type:M.METHOD,action:F.ADDED,item:this.extractMethodName(l.method),file:l.file});for(let l of e.internalChanges.modifiedMethods)l.signatureChanged&&n.push({type:M.METHOD,action:F.MODIFIED,item:this.extractMethodName(l.method),file:l.file})}let c=this.generateFrontendChangelogEntries(e);return{moduleName:e.moduleName,versionBump:e.versionRecommendation.recommendedBump,breakingChanges:t,improvements:i,adjustments:n,deprecations:r,transfers:o.length>0?o:void 0,frontendChanges:c.length>0?c:void 0}}generateFrontendChangelogEntries(e){let t=[];if(!e.frontendChanges)return t;for(let i of e.frontendChanges.detailedChanges){for(let n of i.breakingChanges)t.push({type:"frontend",action:"breaking",item:i.componentName,details:n,file:i.file});for(let n of i.improvements)t.push({type:"frontend",action:"improvement",item:i.componentName,details:n,file:i.file});for(let n of i.fixes)t.push({type:"frontend",action:"fix",item:i.componentName,details:n,file:i.file})}return t}generateSummary(e){let t=0,i=0,n=0;for(let s of e.values())s.versionBump===L.MAJOR?t++:s.versionBump===L.MINOR?i++:n++;let r=t>0?O.HIGH.level:i>0?O.MEDIUM.level:O.LOW.level;return{totalModules:e.size,majorReleases:t,minorReleases:i,patchReleases:n,overallRisk:r}}extractMethodName(e){let t=e.split("\\");return t[t.length-1]}extractClassName(e){let t=e.split("\\");return t[t.length-1].split("::")[0]}formatAsJson(e){let t={summary:e.summary,modules:{}};for(let[i,n]of e.modules)t.modules[i]={versionBump:n.versionBump,breakingChanges:n.breakingChanges,improvements:n.improvements,adjustments:n.adjustments,deprecations:n.deprecations,...n.transfers&&{transfers:n.transfers},...n.frontendChanges&&{frontendChanges:n.frontendChanges}};return JSON.stringify(t,null,2)}}});import{globby as jt}from"globby";var pe=class{constructor(){let e={parser:{php7:!0,extractDoc:!0,suppressErrors:!0},ast:{withPositions:!0},lexer:{all_tokens:!0}},t;try{t=Ce("php-parser")}catch{throw new Error("Failed to load php-parser module")}if(typeof t=="function")this.parser=new t(e);else if(t&&typeof t.Engine=="function")this.parser=new t.Engine(e);else if(t&&typeof t.default=="function")this.parser=new t.default(e);else throw new Error("Unsupported php-parser API")}parseCode(e,t){return this.parser.parseCode(e,t)}walk(e,t){if(!(!e||typeof e!="object")){t(e);for(let i in e){let n=e[i];n&&(Array.isArray(n)?n.forEach(r=>this.walk(r,t)):n&&typeof n=="object"&&n.kind&&this.walk(n,t))}}}},Ut=new pe,{walk:en}=Ut;R();import*as Lt from"fs";R();var y=class{static nsNameToString(e){return e?typeof e=="string"?e:e.kind==="name"&&typeof e.name=="string"?e.name:String(e.name||e):""}static nameNodeToString(e){return e?typeof e=="string"?e:e.kind==="identifier"?String(e.name):e.kind==="name"&&typeof e.name=="string"?e.name:String(e.name||e):""}static addUseItemToMap(e,t,i,n){if(e.type&&e.type!=="class")return;let r=e.alias?.name?String(e.alias.name):null,s;if(n){let c=this.nameNodeToString(e.name);s=n+"\\"+c}else{let c=this.nameNodeToString(e.name);s=c.startsWith("\\")?c:"\\"+c}let a=s.startsWith("\\")?s:"\\"+s,o=(r||a.split("\\").pop()||"").toLowerCase();i[o]=a}static resolveName(e,t,i){let n=this.nameNodeToString(e);if(!n)return null;if(n.startsWith("\\"))return T(n.replace(/^\\+/,""));if(e?.kind==="name"&&e.resolution==="fqn")return T(n.replace(/^\\+/,""));let r=n.split("\\"),s=r[0],a=r.slice(1).join("\\");if(i){let o=i[s.toLowerCase()];if(o)return T(a?o+"\\"+a:o)}return T(t?`${t}\\${n}`:n)}static getIdentifierName(e){return e?e.kind==="identifier"||e.kind==="name"?String(e.name):e.kind==="string"?String(e.value):null:null}};R();R();var Me={FACTORY_METHOD:/@method\s+\\?([A-Za-z_][\w\\]+)\s+get(?:BusinessFactory|Factory)\s*\(/,VAR_TYPE:/@var\s+([^\s*]+)/i},me={DOC_START:"/**",DOC_END:"*/",LINE_PREFIX:/^\s*\*\s?/,TAG_PREFIX:"@"},St={PUBLIC:"public",PROTECTED:"protected",PRIVATE:"private"};var j=class{static parse(e){if(!e)return{};let t=this.extractDescription(e),i=e.includes("@api"),n=e.includes("@deprecated");return{description:t,isApiMethod:i,isDeprecated:n}}static extractDescription(e){let t=[],i=e.split(`
`);for(let n of i){let r=n.replace(me.LINE_PREFIX,"").trim();if(!this.shouldSkipLine(r)){if(r.startsWith(me.TAG_PREFIX))break;t.push(r)}}return t.length>0?t.join(" ").trim():void 0}static collectCommentText(e){let t=[],i=n=>{n&&typeof n.value=="string"&&t.push(n.value)};return Array.isArray(e.leadingComments)&&e.leadingComments.forEach(i),Array.isArray(e.comments)&&e.comments.forEach(i),t.join(`
`)}static shouldSkipLine(e){return e.startsWith(me.DOC_START)||e.startsWith(me.DOC_END)||e===""}};var ae=class{constructor(e){this.logger=e}indexMethod(e,t,i,n,r=!1){let s=this.extractMethodName(e);if(!s)return;let a=N(t,s),o=this.createMethodMetadata(e,t,i,s,r);n.set(a,o),this.logMethod(a,o,r)}extractMethodName(e){return e.name?String(e.name.name):null}createMethodMetadata(e,t,i,n,r){let s=j.collectCommentText(e),a=j.parse(s);return{visibility:e.visibility||St.PUBLIC,file:i,start:e.loc?.start?.line||null,end:e.loc?.end?.line||null,classFQN:t,name:n,isInterface:r,description:a.description,isApiMethod:a.isApiMethod,isDeprecated:a.isDeprecated}}logMethod(e,t,i){if(this.logger){if(i){this.logger("[iface-method]",e);return}this.logger("[method]",e,"loc",`${t.start}-${t.end}`)}}};var g={NAMESPACE:"namespace",USE_ITEM:"useitem",USE_GROUP:"usegroup",CLASS:"class",INTERFACE:"interface",METHOD:"method",PROPERTY:"property",CALL:"call",STATIC_CALL:"staticcall",NEW:"new",VARIABLE:"variable",ASSIGN:"assign",PROPERTY_LOOKUP:"propertylookup",NAME:"name",NULLABLE_TYPE:"nullabletype",RETURN:"return"},wt={FQN:"fqn"},fe={THIS:"this"},ve={SELF:"self",STATIC:"static",PARENT:"parent"},Y={CONSTRUCT:"__construct",GET_FACTORY:"getFactory",GET_BUSINESS_FACTORY:"getBusinessFactory"},Ne={CLASS:"class",INTERFACE:"interface"};var Pe=class{constructor(e){this.logger=e;this.methodIndexer=new ae(e)}indexClass(e,t,i,n,r,s,a,o){let c=this.extractClassName(e);if(!c)return;let l=this.buildFullyQualifiedName(i,c);r.set(l,{file:t,kind:Ne.CLASS}),this.logClass(l,t),this.indexImplementedInterfaces(e,l,i,n,o),this.indexFactoryAnnotation(e,l,a),this.indexClassMethods(e,l,t,s)}extractClassName(e){return e.name?String(e.name.name):null}buildFullyQualifiedName(e,t){return T(e?`${e}\\${t}`:t)}indexImplementedInterfaces(e,t,i,n,r){if(!(!Array.isArray(e.implements)||!e.implements.length))for(let s of e.implements){let a=y.resolveName(s,i,n);a&&(r.has(t)||r.set(t,new Set),r.get(t).add(a),this.logger?.("[implements]",t,"->",a))}}indexFactoryAnnotation(e,t,i){let n=j.collectCommentText(e),r=this.extractFactoryFromDoc(n);r&&(i.set(t,r),this.logger?.("[factory-doc]",t,"->",r))}extractFactoryFromDoc(e){if(!e)return null;let t=e.match(Me.FACTORY_METHOD);return t?"\\"+t[1].replace(/^\\+/,""):null}indexClassMethods(e,t,i,n){if(Array.isArray(e.body))for(let r of e.body)r.kind===g.METHOD&&this.methodIndexer.indexMethod(r,t,i,n,!1)}logClass(e,t){this.logger?.("[class]",e,"@",t)}};R();var Fe=class{constructor(e){this.logger=e;this.methodIndexer=new ae(e)}indexInterface(e,t,i,n){let r=this.extractInterfaceName(e);if(!r)return null;let s=this.buildFullyQualifiedName(i,r);return this.indexInterfaceMethods(e,s,t,n),this.logInterface(s,t),s}extractInterfaceName(e){return e.name?String(e.name.name):null}buildFullyQualifiedName(e,t){return T(e?`${e}\\${t}`:t)}indexInterfaceMethods(e,t,i,n){if(Array.isArray(e.body))for(let r of e.body)r.kind===g.METHOD&&this.methodIndexer.indexMethod(r,t,i,n,!0)}logInterface(e,t){this.logger?.("[interface]",e,"@",t)}};R();var we=class{resolve(e,t){let{AnalyzerConfig:i}=(ie(),Rt(Ot));for(let[n,r]of e.entries())this.needsInheritance(r,i)&&this.inheritFromInterface(r,t,e,i)}needsInheritance(e,t){return e.description===t.phpDocAnnotations.inheritDoc||!e.description}inheritFromInterface(e,t,i,n){let r=t.get(e.classFQN);if(r)for(let s of r){let a=N(s,e.name),o=i.get(a);if(this.isValidInheritanceSource(o,n)){this.copyMetadata(e,o);break}}}isValidInheritanceSource(e,t){return!!e&&!!e.description&&e.description!==t.phpDocAnnotations.inheritDoc}copyMetadata(e,t){e.description=t.description,e.isApiMethod=t.isApiMethod,e.isDeprecated=t.isDeprecated}};var ke=class{constructor(e,t){this.parser=e;this.classIndexer=new Pe(t),this.interfaceIndexer=new Fe(t),this.inheritDocResolver=new we}async indexSymbols(e){let t=new Map,i=new Map,n=new Map,r=new Map;for(let s of e)await this.indexFile(s,t,i,n,r);return this.inheritDocResolver.resolve(i,r),{classes:t,methods:i,ownerToFactory:n,classImplements:r}}async indexFile(e,t,i,n,r){let s=Lt.readFileSync(e,"utf8"),a=await this.parseCode(s,e);a&&this.processAst(a,e,t,i,n,r)}async parseCode(e,t){try{return this.parser.parseCode(e,t)}catch{return null}}processAst(e,t,i,n,r,s){let a="",o={};this.parser.walk(e,c=>{if(c.kind===g.NAMESPACE&&(a=y.nsNameToString(c.name),o={}),c.kind===g.USE_ITEM&&y.addUseItemToMap(c,a,o),c.kind===g.USE_GROUP&&this.processUseGroup(c,a,o),c.kind===g.INTERFACE){let l=this.interfaceIndexer.indexInterface(c,t,a,n);l&&i.set(l,{file:t,kind:Ne.INTERFACE});return}c.kind===g.CLASS&&this.classIndexer.indexClass(c,t,a,o,i,n,r,s)})}processUseGroup(e,t,i){let n=y.nsNameToString(e.name),r=n.startsWith("\\")?n:"\\"+n;for(let s of e.items||[])y.addUseItemToMap(s,t,i,r)}};import*as Vt from"fs";R();var B={CLASS_SUFFIX:/Factory$/,METHOD_PREFIXES:["create","get"],METHOD_ANNOTATION:/@method\s+([^\s]+)\s+(\w+)\s*\(/gi,RETURN_ANNOTATION:/@return\s+([^\s*]+)/i};var re=class{static isFactoryClass(e){return B.CLASS_SUFFIX.test(String(e))}static isFactoryMethod(e){return e?B.METHOD_PREFIXES.some(t=>e.startsWith(t)):!1}};var Oe=class{constructor(e){this.parser=e}extractReturnType(e,t,i){let n=this.extractFromCode(e,t,i);return n||this.extractFromDocBlock(e,t,i)}extractFromCode(e,t,i){let n=new Map,r=null;return this.parser.walk(e,s=>{r||(this.isVariableInstantiation(s)&&this.trackVariableInstantiation(s,n,t,i),this.isReturnStatement(s)&&(r=this.resolveReturnExpression(s,n,t,i)))}),r}isVariableInstantiation(e){return e.kind===g.ASSIGN&&e.left?.kind===g.VARIABLE&&e.right?.kind===g.NEW}trackVariableInstantiation(e,t,i,n){let r=e,s=typeof r.left.name=="string"?r.left.name:null,a=y.resolveName(r.right.what,i,n);s&&a&&t.set(s,a)}isReturnStatement(e){return e.kind===g.RETURN&&e.expr}resolveReturnExpression(e,t,i,n){let s=e.expr;return s.kind===g.NEW?y.resolveName(s.what,i,n):s.kind===g.VARIABLE&&typeof s.name=="string"&&t.get(s.name)||null}extractFromDocBlock(e,t,i){let n=this.collectCommentText(e);return this.extractFromDoc(n,t,i)}collectCommentText(e){let t=[];return Array.isArray(e.leadingComments)&&t.push(...e.leadingComments.map(i=>i.value||"")),e.doc&&typeof e.doc=="string"&&t.push(e.doc),Array.isArray(e.comments)&&t.push(...e.comments.map(i=>i.value||"")),t.join(`
`)}extractFromDoc(e,t,i){if(!e)return null;let n=this.parseReturnAnnotation(e);return n?this.resolveTypeString(n,t,i):null}parseReturnAnnotation(e){let t=e.match(B.RETURN_ANNOTATION);return t&&t[1].split("|")[0].trim().replace(/\[\]$/,"")||null}resolveTypeString(e,t,i){let n=e.startsWith("\\"),r={kind:g.NAME,name:e,resolution:n?wt.FQN:null};return y.resolveName(r,t,i)}};R();var Le=class{constructor(e,t){this.returnTypeExtractor=e;this.logger=t}extractAnnotations(e,t,i,n,r){let s=this.collectCommentText(e);if(!s)return;let a=this.parseAnnotations(s);for(let o of a)this.processAnnotation(o,t,i,n,r)}collectCommentText(e){let t=[];return Array.isArray(e.leadingComments)&&t.push(...e.leadingComments.map(i=>i.value||"")),e.doc&&typeof e.doc=="string"&&t.push(e.doc),Array.isArray(e.comments)&&t.push(...e.comments.map(i=>i.value||"")),t.join(`
`)}parseAnnotations(e){let t=[],i=new RegExp(B.METHOD_ANNOTATION),n;for(;(n=i.exec(e))!==null;)t.push({returnType:n[1],methodName:n[2]});return t}processAnnotation(e,t,i,n,r){let s=this.returnTypeExtractor.resolveTypeString(e.returnType,i,n);s&&re.isFactoryMethod(e.methodName)&&this.registerReturnType(t,e.methodName,s,r)}registerReturnType(e,t,i,n){let r=N(e,t),s=T(i);n.set(r,s),this.logger?.("[factory-return]",r,"=>",s)}};var Ve=class{constructor(e,t){this.parser=e;this.logger=t;this.returnTypeExtractor=new Oe(e),this.annotationParser=new Le(this.returnTypeExtractor,t)}async indexFactoryReturnTypes(e){let t=new Map;for(let i of e)await this.processFile(i,t);return{factoryReturnByClassMethod:t}}async processFile(e,t){let i=await this.parseFile(e);if(!i)return;let n="",r={};this.parser.walk(i,s=>{this.updateNamespaceContext(s,n,r,(a,o)=>{n=a,r=o}),s.kind===g.CLASS&&this.processClass(s,n,r,t)})}async parseFile(e){let t=Vt.readFileSync(e,"utf8");try{return this.parser.parseCode(t,e)}catch{return null}}updateNamespaceContext(e,t,i,n){if(e.kind===g.NAMESPACE){let r=y.nsNameToString(e.name);n(r,{});return}if(e.kind===g.USE_ITEM){y.addUseItemToMap(e,t,i);return}if(e.kind===g.USE_GROUP){let r=y.nsNameToString(e.name),s=r.startsWith("\\")?r:"\\"+r;for(let a of e.items||[])y.addUseItemToMap(a,t,i,s)}}processClass(e,t,i,n){let r=e.name?String(e.name.name):null;if(!r)return;let s=T(t?`${t}\\${r}`:r);if(this.annotationParser.extractAnnotations(e,s,t,i,n),!!re.isFactoryClass(s)&&Array.isArray(e.body))for(let a of e.body)a.kind===g.METHOD&&this.processFactoryMethod(a,s,t,i,n)}processFactoryMethod(e,t,i,n,r){let s=e.name?String(e.name.name):"";if(!re.isFactoryMethod(s))return;let a=this.returnTypeExtractor.extractReturnType(e,i,n);a&&this.registerReturnType(t,s,a,r)}registerReturnType(e,t,i,n){let r=N(e,t),s=T(i);n.set(r,s),this.logger?.("[factory-return]",r,"=>",s)}};R();import Gt from"graphology";var Qe=class{constructor(e){this.methods=e;this.graph=new Gt,this.reverseAdjacencyMap=new Map}ensureMethodNode(e,t,i){if(!this.graph.hasNode(e)){let n=this.methods.get(e);this.graph.addNode(e,n?{classFQN:n.classFQN,method:n.name,visibility:n.visibility}:{classFQN:T(t),method:i,visibility:"unknown"})}}addEdge(e,t,i){this.graph.hasEdge(e,t)||this.graph.addEdge(e,t,{kind:i}),this.reverseAdjacencyMap.has(t)||this.reverseAdjacencyMap.set(t,new Set),this.reverseAdjacencyMap.get(t).add(e)}getGraph(){return this.graph}getReverseAdjacencyMap(){return this.reverseAdjacencyMap}};var _e=class{constructor(e){this.logger=e}processMethodParameters(e,t,i,n,r,s,a){let o=this.extractParameters(e);for(let c of o){let l=this.extractParameterName(c),m=this.resolveParameterType(c,r,s);l&&m&&(a[l]=m,t===Y.CONSTRUCT&&this.isPromotedProperty(c)&&(n[l]=m,this.logger?.("[prop-promoted]",`${i}::$${l}`,"=>",m)))}}extractParameters(e){return Array.isArray(e?.params)?e.params:Array.isArray(e?.arguments)?e.arguments:[]}extractParameterName(e){return e.name&&typeof e.name.name=="string"?String(e.name.name):typeof e.name=="string"?e.name:null}resolveParameterType(e,t,i){if(!e.type)return null;let n=e.type.kind===g.NULLABLE_TYPE?e.type.what:e.type;return y.resolveName(n,t,i)}isPromotedProperty(e){let t=!!(e.flags&&e.flags!==0),i=!!(e.visibility&&e.visibility!==null);return t||i}};var qt=/^(int|float|string|bool|array|iterable|callable|mixed|object|null)$/i,ue=class{static extractVarFqnFromDoc(e,t,i){if(!e)return null;let n=e.match(Me.VAR_TYPE);return n?this.resolveFirstNonPrimitiveType(n[1],t,i):null}static resolveFirstNonPrimitiveType(e,t,i){for(let n of e.split("|")){let r=n.replace(/\[\]$/,"").trim();if(!r||qt.test(r))continue;let s=this.resolveSingleType(r,t,i);if(s)return s}return null}static resolveSingleType(e,t,i){let n=e.startsWith("\\")?{kind:"name",name:e,resolution:"fqn"}:{kind:"name",name:e,resolution:null};return y.resolveName(n,t,i)}static collectCommentText(e){let t=[],i=n=>{n&&typeof n.value=="string"&&t.push(n.value)};return Array.isArray(e.leadingComments)&&e.leadingComments.forEach(i),Array.isArray(e.comments)&&e.comments.forEach(i),t.join(`
`)}};var Be=class{constructor(e){this.logger=e}processPropertyDeclaration(e,t,i,n,r){let s=this.extractPropertyType(e,n,r);s&&this.registerPropertyTypes(e,t,i,s)}trackPropertyAssignment(e,t,i,n){let r=e.left;if(r.what?.kind===g.VARIABLE&&r.what.name===fe.THIS){let a=y.getIdentifierName(r.offset),o=n(e.right);a&&o&&(i[a]=o,this.logger?.("[prop-type]",`${t}::$${a}`,"=>",o))}}trackLocalVariable(e,t,i,n){let r=typeof e.left.name=="string"?e.left.name:null,s=y.resolveName(e.right.what,i,n);r&&s&&(t[r]=s)}extractPropertyType(e,t,i){let n=this.extractDeclaredType(e,t,i);if(n)return n;let r=ue.collectCommentText(e);return ue.extractVarFqnFromDoc(r,t,i)}extractDeclaredType(e,t,i){if(!e.type)return null;let n=e.type.kind===g.NULLABLE_TYPE?e.type.what:e.type;return y.resolveName(n,t,i)}registerPropertyTypes(e,t,i,n){for(let r of e.properties||[]){let s=this.extractPropertyName(r);s&&!i[s]&&(i[s]=n,this.logger?.("[prop-decl]",`${t}::$${s}`,"=>",n))}}extractPropertyName(e){return e.name?.name?String(e.name.name):typeof e.name=="string"?e.name:null}};var $e=class{resolveExpressionType(e,t,i,n,r){return e?e.kind===g.NEW?this.resolveNewExpression(e,n,r):e.kind===g.VARIABLE?this.resolveVariableType(e,t,i):null:null}resolveNewExpression(e,t,i){return y.resolveName(e.what,t,i)}resolveVariableType(e,t,i){let n=e.name;return typeof n!="string"?null:t[n]||i[n]||null}};var de=class{static unwrapChain(e){let t=[],i=e,n=null;for(;i;){if(i.kind==="call"){i=i.what;continue}if(i.kind==="propertylookup"||i.kind==="nullsafe_propertylookup"||i.kind==="staticlookup"){let s=y.getIdentifierName(i.offset);s&&t.push(s),n=i.what,i=i.what;continue}n=i;break}t.reverse();let r=t.length?t[t.length-1]:null;return{names:t,base:n,tail:r}}};R();R();var zt=[{regex:/^(.*\\Zed\\)([^\\]+)\\Business(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\Business\\${p[2]}BusinessFactory`},{regex:/^(.*\\Zed\\)([^\\]+)\\Communication(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\Communication\\${p[2]}CommunicationFactory`},{regex:/^(.*\\Zed\\)([^\\]+)\\Persistence(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\Persistence\\${p[2]}PersistenceFactory`},{regex:/^(.*\\Client\\)([^\\]+)(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\${p[2]}Factory`},{regex:/^(.*\\Service\\)([^\\]+)(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\${p[2]}ServiceFactory`},{regex:/^(.*\\Glue\\)([^\\]+)(?:\\|$)/,template:p=>`${p[1]}${p[2]}\\${p[2]}Factory`}],se=class{static factoryClassFor(e,t){let i=T(e),n=t.get(i);return n||this.resolveByConvention(i)}static resolveByConvention(e){let t=String(e);for(let i of zt){let n=t.match(i.regex);if(n)return T(i.template(n))}return null}};var He=class{constructor(e,t){this.ownerToFactory=e;this.factoryReturnByClassMethod=t}resolveFactoryCallReturnType(e,t){if(!t)return null;let n=de.unwrapChain(e).names;if(!this.isFactoryMethodChain(n))return null;let r=this.findFactoryMethodIndex(n);if(r===-1)return null;let s=n[r];return typeof s!="string"?null:this.lookupFactoryReturnType(t,s)}isFactoryMethodChain(e){return e.includes(Y.GET_FACTORY)||e.includes(Y.GET_BUSINESS_FACTORY)}findFactoryMethodIndex(e){for(let t=e.length-1;t>=0;t--){let i=e[t];if(i===Y.GET_FACTORY||i===Y.GET_BUSINESS_FACTORY)break;if(typeof i=="string"&&this.isFactoryMethod(i))return t}return-1}isFactoryMethod(e){return B.METHOD_PREFIXES.some(t=>e.startsWith(t))}lookupFactoryReturnType(e,t){let i=se.factoryClassFor(e,this.ownerToFactory);if(!i)return null;let n=N(i,t);return this.factoryReturnByClassMethod.get(n)||null}};var q={STATIC:"static",INTRA:"intra",THIS_PROPERTY:"this-prop",METHOD:"method",FACTORY_RETURN:"factory-return",INTERFACE_IMPL:"iface-impl"};var Ke=class{processStaticCall(e,t,i,n,r){let s=this.resolveReceiver(e,t,i,n),a=y.getIdentifierName(e.what);a&&r(s,a,q.STATIC)}resolveReceiver(e,t,i,n){if(e.class?.kind===g.NAME){let r=String(e.class.name).toLowerCase();if(this.isSelfReference(r))return t}return y.resolveName(e.class,i,n)}isSelfReference(e){return e===ve.SELF||e===ve.STATIC||e===ve.PARENT}};R();var We=class{constructor(e,t){this.interfaceToImplementations=e;this.logger=t}processDirectCall(e,t,i,n){this.isThisCall(e)&&this.isSingleMethodCall(e)&&n(t,i,q.INTRA)}processPropertyCall(e,t,i,n,r,s){if(!this.isThisCall(e)||!this.hasPropertyAccess(e))return;let a=e.names[0],o=n[a];if(o){s(o,r,q.THIS_PROPERTY),this.logger?.("[this-prop]",N(t,i),"->",`${o}::${r}`),this.addInterfaceEdges(o,r,s);return}this.logger?.("[prop-miss]",N(t,i),"prop",a,"no type found")}processVariableCall(e,t,i,n,r){let s=this.extractVariableName(e);if(!s||s===fe.THIS)return;let a=t[s]||i[s]||null;a&&(r(a,n,q.METHOD),this.addInterfaceEdges(a,n,r))}isThisCall(e){return e.base?.kind===g.VARIABLE&&e.base.name===fe.THIS}isSingleMethodCall(e){return e.names.length===1}hasPropertyAccess(e){return e.names.length>=2}extractVariableName(e){if(e.base?.kind!==g.VARIABLE)return null;let t=e.base.name;return typeof t=="string"?t:null}addInterfaceEdges(e,t,i){let n=this.interfaceToImplementations.get(T(e));if(n)for(let r of n)i(r,t,q.INTERFACE_IMPL),this.logger?.("[iface-impl]",String(e),"\u21D2",`${String(r)}::${t}`)}};R();var Ue=class{constructor(e,t){this.ownerToFactory=e;this.factoryReturnByClassMethod=t}processFactoryCall(e,t,i,n){let r=this.findFactoryMethodIndex(e.names,t);if(r!==-1){let s=e.names[r],a=this.resolveReturnType(t,s);a&&n(a,i,q.FACTORY_RETURN)}}findFactoryMethodIndex(e,t){for(let i=e.length-2;i>=0;i--){let n=e[i];if(typeof n=="string"&&this.isFactoryMethod(n)&&this.hasReturnType(t,n))return i}return-1}isFactoryMethod(e){return B.METHOD_PREFIXES.some(t=>e.startsWith(t))}hasReturnType(e,t){let i=N(e,t);if(this.factoryReturnByClassMethod.has(i))return!0;let n=se.factoryClassFor(e,this.ownerToFactory);if(n){let r=N(n,t);return this.factoryReturnByClassMethod.has(r)}return!1}resolveReturnType(e,t){let i=se.factoryClassFor(e,this.ownerToFactory);if(!i)return null;let n=N(i,t);return this.factoryReturnByClassMethod.get(n)||null}};var Ge=class{constructor(e,t,i,n){this.staticCallHandler=new Ke,this.instanceCallHandler=new We(i,n),this.factoryCallHandler=new Ue(e,t)}processStaticCall(e,t,i,n,r){this.staticCallHandler.processStaticCall(e,t,i,n,r)}processInstanceCall(e,t,i,n,r,s,a){let o=de.unwrapChain(e),c=o.tail;c&&(this.instanceCallHandler.processDirectCall(o,t,c,a),this.instanceCallHandler.processPropertyCall(o,t,i,n,c,a),this.instanceCallHandler.processVariableCall(o,r,s,c,a),this.factoryCallHandler.processFactoryCall(o,t,c,a))}};import*as Qt from"fs";var qe=class{constructor(e){this.parser=e}async processFiles(e,t){for(let i of e)await this.processFile(i,t)}async processFile(e,t){let i=Qt.readFileSync(e,"utf8");try{let n=this.parser.parseCode(i,e);t(n)}catch{return}}};var ze=class{constructor(e){this.parser=e}walkAst(e,t){let i="",n={};this.parser.walk(e,r=>{if(r.kind===g.NAMESPACE){i=y.nsNameToString(r.name),n={};return}if(r.kind===g.USE_ITEM){y.addUseItemToMap(r,i,n);return}if(r.kind===g.USE_GROUP){this.processUseGroup(r,i,n);return}r.kind===g.CLASS&&t(r,i,n)})}processUseGroup(e,t,i){let n=y.nsNameToString(e.name),r=n.startsWith("\\")?n:"\\"+n;for(let s of e.items||[])y.addUseItemToMap(s,t,i,r)}};R();var je=class{constructor(e,t,i,n,r,s){this.parser=e;this.graphBuilder=t;this.parameterProcessor=i;this.propertyTypeTracker=n;this.methodCallProcessor=r;this.propertyTypesByClass=s}processClass(e,t,i,n){let r=e.name?String(e.name.name):null;if(!r)return;let s=T(t?`${t}\\${r}`:r);if(!Array.isArray(e.body))return;let a=this.propertyTypesByClass.get(s)||{};this.propertyTypesByClass.set(s,a);for(let o of e.body){if(o.kind===g.PROPERTY){this.propertyTypeTracker.processPropertyDeclaration(o,s,a,t,i);continue}o.kind===g.METHOD&&this.processMethod(o,s,a,t,i,n)}}processMethod(e,t,i,n,r,s){let a=e.name?String(e.name.name):null;if(!a)return;let o=N(t,a),c={},l={};this.parameterProcessor.processMethodParameters(e,a,t,i,n,r,l),this.graphBuilder.ensureMethodNode(o,t,a),this.parser.walk(e,m=>{this.processMethodBody(m,t,a,o,i,c,l,n,r,s)})}processMethodBody(e,t,i,n,r,s,a,o,c,l){if(e.kind===g.ASSIGN){this.handleAssignment(e,t,r,s,o,c,l);return}if(e.kind===g.STATIC_CALL){this.methodCallProcessor.processStaticCall(e,t,o,c,(m,C,f)=>this.addEdge(n,m,C,f));return}e.kind===g.CALL&&this.methodCallProcessor.processInstanceCall(e,t,i,r,s,a,(m,C,f)=>this.addEdge(n,m,C,f))}handleAssignment(e,t,i,n,r,s,a){let o=e.left?.kind===g.VARIABLE,c=e.left?.kind===g.PROPERTY_LOOKUP;o&&e.right?.kind===g.NEW&&this.propertyTypeTracker.trackLocalVariable(e,n,r,s),c&&this.propertyTypeTracker.trackPropertyAssignment(e,t,i,a)}addEdge(e,t,i,n){if(!t||!i)return;let r=N(t,i);this.graphBuilder.ensureMethodNode(r,t,i),this.graphBuilder.addEdge(e,r,n)}};R();var Ye=class{constructor(e,t,i,n,r,s,a){this.graphBuilder=new Qe(t),this.fileProcessor=new qe(e),this.astWalker=new ze(e),this.typeResolver=new $e,this.factoryCallResolver=new He(i,n);let o=new _e(s),c=new Be(s),l=new Ge(i,n,this.buildInterfaceMap(r),s);this.propertyTypesByClass=new Map,this.classProcessor=new je(e,this.graphBuilder,o,c,l,this.propertyTypesByClass)}buildInterfaceMap(e){let t=new Map;for(let[i,n]of e)for(let r of n){let s=T(r);t.has(s)||t.set(s,new Set),t.get(s).add(T(i))}return t}async indexEdges(e){return await this.fileProcessor.processFiles(e,t=>{this.astWalker.walkAst(t,(i,n,r)=>{let s=i.name?String(i.name.name):null;if(!s)return;let a=T(n?`${n}\\${s}`:s);this.classProcessor.processClass(i,n,r,o=>{let c=this.typeResolver.resolveExpressionType(o,{},{},n,r);return c||(o?.kind===g.CALL?this.factoryCallResolver.resolveFactoryCallReturnType(o,a):null)})})}),{graph:this.graphBuilder.getGraph(),reverseAdjacencyMap:this.graphBuilder.getReverseAdjacencyMap()}}};R();var Xe=class{static linkInterfaceEdges(e,t,i){let n=new Map;for(let[,r]of e)n.has(r.classFQN)||n.set(r.classFQN,new Set),n.get(r.classFQN).add(r.name);for(let[r,s]of t){let a=n.get(r);if(a)for(let o of s)for(let c of a){let l=N(r,c),m=N(o,c);i.has(l)||i.set(l,new Set),i.get(l).add(m)}}}};var Je=class{static findImpactedEntrypoints(e,t,i,n){let r=new Map,s=[{key:e,distance:0}],a=new Set([e]);for(;s.length>0;){let c=s.shift(),l=i.get(c.key);if(l)for(let m of l)a.has(m)||(a.add(m),r.set(m,c.distance+1),s.push({key:m,distance:c.distance+1}))}let o=[];for(let[c,l]of r){let m=t.get(c);if(!m)continue;let C=(m.visibility||"public")==="public";n.test(m.classFQN)&&C&&o.push({key:c,class:m.classFQN,method:m.name,hops:l,description:m.description,isApiMethod:m.isApiMethod,isDeprecated:m.isDeprecated})}return o.sort((c,l)=>c.hops-l.hops||c.key.localeCompare(l.key)),o}};var Ze=class{constructor(e){this.config=e}async analyze(){let{root:e,globs:t,excludes:i,targets:n,entrypointRegex:r,linkInterfaces:s,debug:a,logger:o}=this.config,c=await jt(t,{cwd:e,absolute:!0,ignore:i});if(!c.length)throw new Error("No PHP files matched the provided globs");a&&console.error("[info] files:",c.length);let l=new pe,m=new ke(l,o),{classes:C,methods:f,ownerToFactory:x,classImplements:d}=await m.indexSymbols(c);a&&console.error("[info] classes:",C.size,"methods:",f.size);let u=new Ve(l,o),{factoryReturnByClassMethod:A}=await u.indexFactoryReturnTypes(c);a&&console.error("[info] factory map:",A.size);let Bt=new Ye(l,f,x,A,d,o,a),{graph:ye,reverseAdjacencyMap:gt}=await Bt.indexEdges(c);a&&console.error("[info] graph nodes:",ye.order,"edges:",ye.size),s&&Xe.linkInterfaceEdges(f,d,gt);let bt=this.normalizeTargets(n),xt={};for(let yt of bt){if(a){let Ct=gt.get(yt);console.error("[debug] target has callers:",!!Ct,"count:",Ct?Ct.size:0)}xt[yt]=Je.findImpactedEntrypoints(yt,f,gt,r)}return{entrypointRegex:r.source,targets:bt,counts:{classes:C.size,methods:f.size,nodes:ye.order,edges:ye.size},impacted:xt,symbolIndex:{classes:C,methods:f,ownerToFactory:x,classImplements:d}}}normalizeTargets(e){let t=[];for(let i of e){let[n,r]=String(i).split("::");if(!n||!r){console.error("Skipping invalid target (expected \\FQCN::method):",i);continue}t.push(N(n,r))}return t}};H();import{execSync as ge}from"child_process";var et=class{constructor(e,t){this.root=e;this.modules=t}getMergeBase(e){return ge(`git merge-base ${e} HEAD`,{cwd:this.root,encoding:"utf-8"}).trim()}getAllChangedFiles(e){let t=Ce("path"),i=ge(`git diff --name-status ${e} HEAD`,{cwd:this.root,encoding:"utf-8"}).split(`
`).filter(a=>a.trim()!=="").map(a=>a.trim()),n=ge("git rev-parse --show-toplevel",{cwd:this.root,encoding:"utf-8"}).trim(),r=t.relative(n,this.root),s=i;return r&&r!=="."&&(s=i.filter(a=>{let o=a.split("	")[1]||a.split(/\s+/)[1];return o&&o.startsWith(r)})),this.modules&&this.modules.length>0&&(s=s.filter(a=>{let o=a.split("	")[1]||a.split(/\s+/)[1];return o?this.modules.some(c=>new RegExp(`[/\\\\]${c}[/\\\\]`,"i").test(o)):!1})),s}getFileDiff(e,t){return ge(`git diff --unified=${Ae.CONTEXT_LINES} ${e} HEAD -- "${t}"`,{cwd:this.root,encoding:"utf-8"}).toString()}getFileContent(e,t){try{return ge(`git show ${e}:"${t}"`,{cwd:this.root,encoding:"utf-8"}).toString()}catch{return""}}getCurrentFileContent(e){try{let t=Ce("fs"),n=Ce("path").join(this.root,e);return t.readFileSync(n,"utf-8")}catch{return""}}mapGitStatusToChangeType(e){return e.startsWith(k.ADDED)?"added":e.startsWith(k.DELETED)?"deleted":"modified"}};X();var tt=class{constructor(e){this.includeTests=e}filterPhpFiles(e){let t=e.filter(i=>(i.split(/\s+/)[1]||"").endsWith(P.PHP)).map(i=>i.split(/\s+/)[1]);return this.includeTests?t:t.filter(i=>!b.TEST_DIRECTORY.test(i))}filterPhpFilesWithStatus(e){let t=e.filter(i=>(i.split("	")[1]||i.split(/\s+/)[1]||"").endsWith(P.PHP)).map(i=>{let n=i.split("	");if(n.length>=2)return{status:n[0],file:n[1]};let r=i.split(/\s+/);return{status:r[0],file:r[1]}});return this.includeTests?t:t.filter(i=>!b.TEST_DIRECTORY.test(i.file))}identifyNonPhpFiles(e,t){let i=[];for(let n of e){let r=n.split(/\s+/),s=r[0],a=r[1];if(!a||a.endsWith(P.PHP)||!Te.some(m=>a.endsWith(m)))continue;let c=a.split(".").pop()||"unknown",l=t(s);i.push({file:a,fileType:c,changeType:l})}return i}};Z();$();var nt=class{extractClassNameFromFilePath(e){let t=e.match(D.CLASS_NAME_FROM_PATH);return t?t[1]:null}buildFQCN(e,t){let i=e.match(ne.SPRYKER_FILE_PATH);if(!i)return"\\"+t;let[,n,r,s,a]=i,o=a.split("/");o.pop();let c=o.join("\\"),l=["\\"+n,r,s];return c&&l.push(c),l.push(t),l.join("\\")}extractMethodNameFromLine(e){let t=e.match(D.METHOD_SIGNATURE);return t?t[1]:null}extractMethodDetails(e){let t=e.match(/\b(public|protected|private)\b/),i=t?t[1]:"public",n=e.includes("static"),r=e.match(/function\s+\w+\s*\((.*?)\)/),s=r?r[1].trim():"";return{visibility:i,params:s,isStatic:n}}isMethodSignatureLine(e){return D.METHOD_SIGNATURE.test(e)}};ie();Z();W();H();import{XMLParser as Yt}from"fast-xml-parser";var it=class{constructor(e){this.gitHelper=e}async analyzeTransferChanges(e,t){let i=[],n=this.filterTransferFiles(e);for(let r of n){let{status:s,file:a}=this.parseGitStatusLine(r),o=this.analyzeTransferFile(s,a,t);i.push(...o)}return i}filterTransferFiles(e){return e.filter(t=>{let n=t.split(/\s+/)[1]||"";return E.patterns.transferSchema.test(n)})}parseGitStatusLine(e){let t=e.split(/\s+/);return{status:t[0],file:t[1]}}analyzeTransferFile(e,t,i){return e.startsWith(k.ADDED)?this.handleAddedTransferFile(t):e.startsWith(k.DELETED)?this.handleDeletedTransferFile(t):this.handleModifiedTransferFile(t,i)}handleAddedTransferFile(e){return this.extractTransferNamesFromFile(e).map(i=>({file:e,transferName:i,changeType:h.NEW}))}handleDeletedTransferFile(e){return[{file:e,transferName:this.extractTransferNameFromPath(e),changeType:h.REMOVED}]}handleModifiedTransferFile(e,t){try{let i=this.gitHelper.getFileContent(t,e),n=this.gitHelper.getCurrentFileContent(e);return this.compareTransferXml(e,i,n)}catch{return[]}}compareTransferXml(e,t,i){let n=new Yt({ignoreAttributes:!1,attributeNamePrefix:"@_"}),r=n.parse(t),s=n.parse(i),a=this.extractTransfersFromParsedXml(r),o=this.extractTransfersFromParsedXml(s);return this.compareTransfers(e,a,o)}extractTransfersFromParsedXml(e){let t=new Map,i=e?.transfers?.transfer;if(!i)return t;let n=Array.isArray(i)?i:[i];for(let r of n){let s=r["@_name"];s&&t.set(s,r)}return t}compareTransfers(e,t,i){let n=[];for(let[r,s]of i){if(!t.has(r)){n.push({file:e,transferName:r,changeType:h.NEW});continue}let a=t.get(r),o=this.compareTransferProperties(a,s);(o.addedProperties.length>0||o.removedProperties.length>0)&&n.push({file:e,transferName:r,changeType:h.MODIFIED,addedProperties:o.addedProperties.length>0?o.addedProperties:void 0,removedProperties:o.removedProperties.length>0?o.removedProperties:void 0})}for(let[r]of t)i.has(r)||n.push({file:e,transferName:r,changeType:h.REMOVED});return n}compareTransferProperties(e,t){let i=this.extractPropertyNames(e),n=this.extractPropertyNames(t),r=n.filter(a=>!i.includes(a)),s=i.filter(a=>!n.includes(a));return{addedProperties:r,removedProperties:s}}extractPropertyNames(e){let t=e?.property;return t?(Array.isArray(t)?t:[t]).map(n=>n["@_name"]).filter(Boolean):[]}extractTransferNamesFromFile(e){try{let i=this.gitHelper.getCurrentFileContent(e).matchAll(Ie.TRANSFER_OPEN);return Array.from(i,n=>n[1])}catch{return[]}}extractTransferNameFromPath(e){let t=e.match(/\/([^\/]+)\.transfer\.xml$/);return t?t[1]:"Unknown"}};ie();Z();W();H();var rt=class{constructor(e,t=""){this.phpParser=e}analyzeDiff(e,t){let i=this.createEmptyResult(),n=this.phpParser.extractClassNameFromFilePath(e);if(!n)return i.skippedFiles.push(this.createSkippedFileForNoClassName(e)),i;let r=this.parseDiffBlocks(t),s=this.buildMethodSignatureTracker(t);return this.processBlocks(e,n,r,s,i),this.processRemovedMethods(e,n,s,i),this.filterOutRemovedFromModified(i),i}filterOutRemovedFromModified(e){let t=new Set(e.removedMethods.map(i=>i.fqcn));e.modifiedMethods=e.modifiedMethods.filter(i=>!t.has(i.fqcn))}processRemovedMethods(e,t,i,n){for(let[r,s]of i.entries())if(s.removed&&!s.added){let a=`${this.phpParser.buildFQCN(e,t)}::${r}`;n.removedMethods.push({name:r,fqcn:a,file:e,visibility:"public"})}}createEmptyResult(){return{newMethods:[],modifiedMethods:[],removedMethods:[],newClasses:[],deprecatedClasses:[],skippedFiles:[],nonPhpFiles:[],transferChanges:[],modifiedFiles:[],schemaChanges:[],composerChanges:[],constantChanges:[],frontendChanges:[]}}createSkippedFileForNoClassName(e){return{file:e,reason:E.skipReasons.noClassName,suggestion:"Ensure file follows naming convention: /path/ClassName.php"}}processBlocks(e,t,i,n,r){for(let s of i)this.processBlock(e,t,s,n,r)}processBlock(e,t,i,n,r){let s=this.findMethodSignaturesInBlock(i);if(i.methodNameFromContext===null||s.length>0){this.processBlockWithoutMethodContext(e,t,i,n,r);return}let a=this.extractMethodNameFromBlock(i);if(!a||!this.blockHasChanges(i))return;let o=this.extractMethodDetails(i),c=`${this.phpParser.buildFQCN(e,t)}::${a}`,l=this.determineChangeType(a,i,n);if(l===h.NEW){r.newMethods.push(this.createNewMethodChange(a,t,c,e,o,i));return}l===h.MODIFIED&&r.modifiedMethods.push(this.createModifiedMethodChange(a,t,c,e,o,i,n))}findMethodSignaturesInBlock(e){let t=[];for(let i of e.lines){if(!this.isAddition(i)&&!this.isRemoval(i))continue;let r=this.removeDiffPrefix(i).match(/^\s*(?:public|protected|private)?\s*(?:static\s+)?function\s+(\w+)\s*\(/);r&&t.push(r[1])}return t}processBlockWithoutMethodContext(e,t,i,n,r){let s=new Map,a=null;for(let o of i.lines){let c=this.removeDiffPrefix(o),l=c.match(D.METHOD_SIGNATURE);if(l&&(a=l[1],s.has(a)||s.set(a,{additions:[],removals:[],lines:[]})),c.match(E.patterns.closingBrace)&&(a=null),!a||!s.has(a))continue;let m=s.get(a);m.lines.push(o),this.isAddition(o)&&m.additions.push(o.slice(1)),this.isRemoval(o)&&m.removals.push(o.slice(1))}for(let[o,c]of s.entries()){if(c.additions.length===0&&c.removals.length===0)continue;let l={context:i.context,lines:c.lines,additions:c.additions,removals:c.removals,methodNameFromContext:o},m=this.extractMethodDetails(l),C=`${this.phpParser.buildFQCN(e,t)}::${o}`,f=this.determineChangeType(o,l,n);if(f===h.NEW){r.newMethods.push(this.createNewMethodChange(o,t,C,e,m,l));continue}f===h.MODIFIED&&r.modifiedMethods.push(this.createModifiedMethodChange(o,t,C,e,m,l,n))}}buildMethodSignatureTracker(e){let t=new Map,i=e.split(`
`);for(let n of i)this.processSignatureLine(n,t);return t}processSignatureLine(e,t){let i=e.match(D.DIFF_METHOD_SIGNATURE);if(!i)return;let[,n,,r]=i;this.ensureMethodInTracker(r,t),this.updateMethodSignature(r,n,t)}ensureMethodInTracker(e,t){t.has(e)||t.set(e,{added:!1,removed:!1})}updateMethodSignature(e,t,i){let n=i.get(e);t===S.ADDITION&&(n.added=!0),t===S.REMOVAL&&(n.removed=!0)}extractMethodNameFromBlock(e){let t=this.findMethodNameInAdditions(e);if(t)return t;let i=this.findMethodNameInChanges(e);return i||(e.methodNameFromContext==="__construct"&&!this.hasConstructorChanges(e)?null:e.methodNameFromContext?e.methodNameFromContext:this.findMethodNameInBlockLines(e))}hasConstructorChanges(e){for(let t of[...e.additions,...e.removals])if(t.match(/function\s+__construct/))return!0;return!1}findMethodNameInChanges(e){for(let t of[...e.additions,...e.removals]){let i=t.match(D.METHOD_SIGNATURE);if(i)return i[1]}return null}findMethodNameInAdditions(e){if(!(e.additions.length>0&&e.removals.length===0))return null;for(let i of e.additions){let n=this.phpParser.extractMethodNameFromLine(i);if(n)return n}return null}findMethodNameInBlockLines(e){for(let t of e.lines){let i=this.phpParser.extractMethodNameFromLine(t);if(i)return i}return null}blockHasChanges(e){return e.additions.length>0||e.removals.length>0}extractMethodDetails(e){for(let t of e.lines){if(!t.match(D.METHOD_SIGNATURE))continue;return{visibility:t.match(E.patterns.visibilityModifier)?.[1]||E.visibilityModifiers.public,params:""}}return{visibility:E.visibilityModifiers.public,params:""}}determineChangeType(e,t,i){let n=i.get(e),r=n?.added&&!n.removed,s=t.additions.length>0||t.removals.length>0;return r?h.NEW:s?h.MODIFIED:h.NONE}createNewMethodChange(e,t,i,n,r,s){return{name:e,fqcn:i,file:n,visibility:r.visibility,params:r.params,addedLines:s.additions,context:s.context}}createModifiedMethodChange(e,t,i,n,r,s,a){let o=a.get(e),c=o?o.added||o.removed:!1,l=this.hasParameterChanges(s),m=c||l;return{name:e,fqcn:i,file:n,visibility:r.visibility,params:r.params,signatureChanged:m,addedLines:s.additions,removedLines:s.removals,context:s.context}}hasParameterChanges(e){let t=/\$\w+\s*[,)]/,i=/=|->|::|;|\{|\}/;for(let n of e.additions)if(t.test(n)&&!i.test(n))return!0;for(let n of e.removals)if(t.test(n)&&!i.test(n))return!0;return!1}parseDiffBlocks(e){let t=e.split(`
`),i=[],n=null;for(let r of t){if(this.isBlockHeader(r)){n=this.startNewBlock(r,i,n);continue}n&&this.addLineToBlock(r,n)}return this.finalizeBlock(n,i),i}isBlockHeader(e){return e.startsWith(E.diffBlockMarker)}startNewBlock(e,t,i){return this.finalizeBlock(i,t),{context:e,lines:[],additions:[],removals:[],methodNameFromContext:this.extractMethodNameFromContext(e)}}finalizeBlock(e,t){!e||e.lines.length===0||t.push(e)}extractMethodNameFromContext(e){let t=e.match(/@@.*?@@\s*(?:public|protected|private)?\s*(?:static\s+)?function\s+(\w+)/);return t?t[1]:null}addLineToBlock(e,t){t.lines.push(e),this.isAddition(e)&&t.additions.push(e.slice(1)),this.isRemoval(e)&&t.removals.push(e.slice(1))}removeDiffPrefix(e){return[E.diffPrefixChars.added,E.diffPrefixChars.removed,E.diffPrefixChars.unchanged].some(i=>e.startsWith(i))?e.slice(1):e}isAddition(e){return e.startsWith(S.ADDITION)&&!e.startsWith(S.ADDITION_FILE)}isRemoval(e){return e.startsWith(S.REMOVAL)&&!e.startsWith(S.REMOVAL_FILE)}};ie();Z();W();H();var st=class{constructor(e){this.gitHelper=e}async analyzeSchemaChanges(e,t){let i=e.filter(r=>r.endsWith(E.filePatterns.schemaXml)),n=[];for(let r of i){let s=r.split("	")[1]||r,a=this.gitHelper.getFileDiff(t,s);if(!a||a.trim()==="")continue;let o=this.parseSchemaChange(s,a);o&&n.push(o)}return n}parseSchemaChange(e,t){let i=this.extractTableName(t);if(!i)return null;let n=this.extractAddedColumns(t),r=this.extractRemovedColumns(t),s=this.detectModifiedColumns(n,r),a=new Set(s.map(m=>m.name));n=n.filter(m=>!a.has(m.name)),r=r.filter(m=>!a.has(m.name));let o=this.extractAddedIndexes(t),c=this.extractRemovedIndexes(t),l=this.determineChangeType(t);return{file:e,tableName:i,changeType:l,addedColumns:n.length>0?n:void 0,removedColumns:r.length>0?r:void 0,modifiedColumns:s.length>0?s:void 0,addedIndexes:o.length>0?o:void 0,removedIndexes:c.length>0?c:void 0}}extractTableName(e){let t=e.match(new RegExp(`${w.TABLE}"([^"]+)"`));return t?t[1]:null}determineChangeType(e){return e.includes(I.NEW_FILE)?h.NEW:e.includes(I.DELETED_FILE)?h.REMOVED:h.MODIFIED}extractAddedColumns(e){let t=[],i=e.split(`
`);for(let n of i)if(n.startsWith(E.diffPrefixChars.added)&&n.includes(w.COLUMN)){let r=this.parseColumnLine(n.substring(1));r&&t.push(r)}return t}extractRemovedColumns(e){let t=[],i=e.split(`
`);for(let n of i)if(n.startsWith(E.diffPrefixChars.removed)&&n.includes(w.COLUMN)){let r=this.parseColumnLine(n.substring(1));r&&t.push(r)}return t}detectModifiedColumns(e,t){let i=[],n=new Map(e.map(r=>[r.name,r]));for(let r of t){let s=n.get(r.name);s&&i.push({name:r.name,oldType:r.type,newType:s.type,type:s.type,size:s.size,required:s.required,description:s.description})}return i}extractAddedIndexes(e){let t=[],i=e.split(`
`);for(let n=0;n<i.length;n++)if(i[n].startsWith(E.diffPrefixChars.added)&&i[n].includes(w.INDEX_NAME)){let r=this.parseIndexBlock(i,n);r&&t.push(r)}return t}extractRemovedIndexes(e){let t=[],i=e.split(`
`);for(let n=0;n<i.length;n++)if(i[n].startsWith(E.diffPrefixChars.removed)&&i[n].includes(w.INDEX_NAME)){let r=this.parseIndexBlock(i,n);r&&t.push(r)}return t}parseColumnLine(e){let t=e.match(/name="([^"]+)"/),i=e.match(/type="([^"]+)"/),n=e.match(/size="([^"]+)"/),r=e.match(/required="([^"]+)"/),s=e.match(/description="([^"]+)"/);return t?{name:t[1],type:i?i[1]:void 0,size:n?n[1]:void 0,required:r?r[1]===J.TRUE_VALUE:void 0,description:s?s[1]:void 0}:null}parseIndexBlock(e,t){let i=e[t],n=i.match(/name="([^"]+)"/),r=i.match(/unique="([^"]+)"/);if(!n)return null;let s=[];for(let a=t+1;a<e.length;a++){let o=e[a];if(o.includes(w.INDEX_CLOSE))break;if(o.includes(w.INDEX_COLUMN)){let c=o.match(/name="([^"]+)"/);c&&s.push(c[1])}}return{name:n[1],columns:s,unique:r?r[1]===J.TRUE_VALUE:void 0}}};X();Z();W();H();var at=class{constructor(e){this.gitHelper=e}async analyzeComposerChanges(e,t){let i=e.filter(r=>r.includes(b.COMPOSER_JSON)),n=[];for(let r of i){let s=r.split("	")[1]||r,a=this.gitHelper.getFileDiff(t,s);if(!a||a.trim()==="")continue;let o=await this.parseComposerChange(s,a,t);o&&n.push(o)}return n}async parseComposerChange(e,t,i){let n=this.determineChangeType(t);if(n===h.REMOVED)return{file:e,changeType:h.REMOVED,dependencyChanges:[]};if(n===h.NEW)return{file:e,changeType:h.NEW,dependencyChanges:[]};let r=this.gitHelper.getFileContent(i,e),s=this.gitHelper.getCurrentFileContent(e),a=this.parseJson(r),o=this.parseJson(s);if(!a||!o)return null;let c=this.detectPhpVersionChange(a,o),l=this.detectDependencyChanges(a,o);return{file:e,changeType:h.MODIFIED,phpVersionChange:c,dependencyChanges:l}}detectPhpVersionChange(e,t){let i=e[V.REQUIRE]?.[V.PHP],n=t[V.REQUIRE]?.[V.PHP];if(i!==n){if(!i&&n)return{new:n,changeType:K.ADDED,requiresMajor:!0};if(i&&!n)return{old:i,changeType:K.REMOVED,requiresMajor:!0};if(i&&n){let r=this.comparePhpVersions(i,n);return{old:i,new:n,changeType:r,requiresMajor:r===K.UPGRADED}}}}comparePhpVersions(e,t){let i=this.extractMinVersion(e),n=this.extractMinVersion(t);return i===n?K.UNCHANGED:n>i?K.UPGRADED:K.DOWNGRADED}extractMinVersion(e){return e.replace(/[^0-9.]/g,"")}detectDependencyChanges(e,t){let i=[],n={...e[V.REQUIRE],...e[V.REQUIRE_DEV]},r={...t[V.REQUIRE],...t[V.REQUIRE_DEV]},s=new Set([...Object.keys(n),...Object.keys(r)]);for(let a of s){if(a===V.PHP)continue;let o=n[a],c=r[a];if(!o&&c)i.push({package:a,changeType:h.ADDED,newConstraint:c,requiresMajor:!1});else if(o&&!c)i.push({package:a,changeType:h.REMOVED,oldConstraint:o,requiresMajor:!0});else if(o!==c){let l=this.compareConstraints(o,c);i.push({package:a,changeType:h.MODIFIED,oldConstraint:o,newConstraint:c,constraintChangeType:l,requiresMajor:l===_.MAJOR||l===_.TIGHTENED})}}return i}compareConstraints(e,t){if(e===t)return _.UNCHANGED;if(t.includes(I.OR_OPERATOR)&&!e.includes(I.OR_OPERATOR))return _.RELAXED;if(e.includes(I.OR_OPERATOR)&&!t.includes(I.OR_OPERATOR))return _.TIGHTENED;let i=this.extractMajorVersion(e),n=this.extractMajorVersion(t);if(i!==n)return _.MAJOR;let r=this.extractMinorVersion(e),s=this.extractMinorVersion(t);return r!==s?_.MINOR:_.PATCH}extractMajorVersion(e){let t=e.match(/(\d+)\./);return t?t[1]:"0"}extractMinorVersion(e){let t=e.match(/\d+\.(\d+)/);return t?t[1]:"0"}parseJson(e){try{return JSON.parse(e)}catch{return null}}determineChangeType(e){return e.includes(I.NEW_FILE)?h.NEW:e.includes(I.DELETED_FILE)?h.REMOVED:h.MODIFIED}};ie();W();H();var ot=class{constructor(e){this.gitHelper=e}async analyzeConstantChanges(e,t){let i=[],n=e.filter(r=>r.endsWith(E.filePatterns.phpExtension));for(let r of n){let s=r.split("	")[1]||r,a=this.gitHelper.getFileDiff(t,s);if(!a||a.trim()==="")continue;let o=await this.analyzeFile(s,a,t);o&&this.hasConstantChanges(o)&&i.push(o)}return i}async analyzeFile(e,t,i){let n=this.determineChangeType(t);if(n===h.NEW||n===h.REMOVED)return null;let r=this.gitHelper.getFileContent(i,e),s=this.gitHelper.getCurrentFileContent(e),a=this.extractConstants(r),o=this.extractConstants(s),c=[],l=[],m=[];for(let[d,u]of o)if(!a.has(d))c.push(u);else{let A=a.get(d);A.value!==u.value&&m.push({name:d,oldValue:A.value,newValue:u.value,visibility:u.visibility})}for(let[d,u]of a)o.has(d)||l.push(u);let C=this.extractClassName(e),f=this.extractFQCN(s||r,e),x=this.isConfigOrConstantsFile(e,C);return{file:e,className:C,fqcn:f,changeType:h.MODIFIED,isConfigOrConstants:x,addedConstants:c.length>0?c:void 0,removedConstants:l.length>0?l:void 0,modifiedConstants:m.length>0?m:void 0}}extractConstants(e){let t=new Map;if(!e)return t;let i=/^\s*(public|protected|private)?\s*const\s+([A-Z_][A-Z0-9_]*)\s*=\s*(.+?);/gm,n;for(;(n=i.exec(e))!==null;){let r=n[1]||"public",s=n[2],a=n[3].trim();t.set(s,{name:s,value:a,visibility:r})}return t}extractClassName(e){let t=e.split("/");return t[t.length-1].replace(".php","")}extractFQCN(e,t){let i=e.match(/namespace\s+([\w\\]+);/),n=this.extractClassName(t);return i?`${i[1]}\\${n}`:n}determineChangeType(e){return e.includes(I.NEW_FILE)?h.NEW:e.includes(I.DELETED_FILE)?h.REMOVED:h.MODIFIED}hasConstantChanges(e){return!!(e.addedConstants&&e.addedConstants.length>0||e.removedConstants&&e.removedConstants.length>0||e.modifiedConstants&&e.modifiedConstants.length>0)}isConfigOrConstantsFile(e,t){return!!(t.endsWith("Config")||t.endsWith("Constants")||e.includes("/Config/"))}};var lt=class{parse(e){return{dataAttributes:this.extractDataAttributes(e),includes:this.extractIncludes(e),blocks:this.extractBlocks(e),variables:this.extractVariables(e),macros:this.extractMacros(e),defineDataVariables:this.extractDefineDataVariables(e),attributesKeys:this.extractAttributesKeys(e),molecules:this.extractMolecules(e),widgets:this.extractWidgets(e)}}extractDataAttributes(e){let t=[],i=/data-([\w-]+)=/g,n;for(;(n=i.exec(e))!==null;)t.push(`data-${n[1]}`);let r=/['"]data-([\w-]+)['"]\s*:/g;for(;(n=r.exec(e))!==null;)t.push(`data-${n[1]}`);return[...new Set(t)]}extractDefineDataVariables(e){let t=[],n=/{%\s*define\s+data\s*=\s*{([^}]+)}/gs.exec(e);if(n){let r=n[1],s=/(\w+)\s*:/g,a;for(;(a=s.exec(r))!==null;)t.push(a[1])}return t}extractAttributesKeys(e){let t=[],i=/attributes\s*:\s*{([^}]+)}/gs,n;for(;(n=i.exec(e))!==null;){let r=n[1],s=/['"]([^'"]+)['"]\s*:/g,a;for(;(a=s.exec(r))!==null;)t.push(a[1])}return[...new Set(t)]}extractMolecules(e){let t=[],i=/molecule\s*\(\s*['"]([^'"]+)['"]\s*\)/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return[...new Set(t)]}extractWidgets(e){let t=[],i=/{%\s*widget\s+['"]([^'"]+)['"]/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return[...new Set(t)]}extractIncludes(e){let t=[],i=/include\s+['"]([^'"]+)['"]/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return t}extractBlocks(e){let t=[],i=/{%\s*block\s+([\w-]+)/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return t}extractVariables(e){let t=[],i=/{{\s*([\w.]+)\s*}}/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return[...new Set(t)]}extractMacros(e){let t=[],i=/{%\s*macro\s+([\w-]+)/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return t}};var dt=class{parse(e){return{classes:this.extractClasses(e),methods:this.extractMethods(e),properties:this.extractProperties(e),events:this.extractEvents(e)}}extractClasses(e){let t=[],i=/(?:export\s+)?class\s+([\w]+)/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return t}extractMethods(e){let t=[],i=/(public|protected|private)?\s+([\w]+)\s*\([^)]*\)/g,n;for(;(n=i.exec(e))!==null;){let r=n[1]||"public",s=n[2];s!=="constructor"&&s!=="if"&&s!=="for"&&s!=="while"&&t.push({name:s,visibility:r})}return t}extractProperties(e){let t=[],i=/(public|protected|private)?\s+([\w]+)\s*[:=]/g,n;for(;(n=i.exec(e))!==null;){let r=n[1]||"public",s=n[2];s!=="const"&&s!=="let"&&s!=="var"&&t.push({name:s,visibility:r})}return t}extractEvents(e){let t=[],i=[/dispatchEvent\s*\(\s*new\s+(?:CustomEvent|Event)\s*\(\s*['"]([^'"]+)['"]/g,/trigger\s*\(\s*['"]([^'"]+)['"]/g,/\$\([^)]+\)\.trigger\s*\(\s*['"]([^'"]+)['"]/g];for(let n of i){let r;for(;(r=n.exec(e))!==null;)t.push(r[1])}return[...new Set(t)]}};var ct=class{parse(e){return{variables:this.extractVariables(e),cssVariables:this.extractCssVariables(e),mixins:this.extractMixins(e),classes:this.extractClasses(e),modifiers:this.extractModifiers(e)}}extractVariables(e){let t=[],i=/\$([\w-]+)\s*:/g,n;for(;(n=i.exec(e))!==null;)t.push(`$${n[1]}`);return[...new Set(t)]}extractCssVariables(e){let t=[],i=/--([\w-]+)\s*:/g,n;for(;(n=i.exec(e))!==null;)t.push(`--${n[1]}`);return[...new Set(t)]}extractMixins(e){let t=[],i=/@mixin\s+([\w-]+)/g,n;for(;(n=i.exec(e))!==null;)t.push(n[1]);return t}extractClasses(e){let t=[],i=/\.([\w-]+)(?:\s|{|,|:)/g,n;for(;(n=i.exec(e))!==null;){let r=n[1];!r.includes("&")&&!e.includes(`&--${r}`)&&t.push(`.${r}`)}return[...new Set(t)]}extractModifiers(e){let t=[],i=/&--([\w-]+)/g,n;for(;(n=i.exec(e))!==null;)t.push(`--${n[1]}`);return t}};var pt=class{constructor(e){this.gitHelper=e;this.twigParser=new lt;this.typescriptParser=new dt;this.scssParser=new ct}async analyzeFrontendChanges(e,t){let i=[];for(let{file:n,changeType:r}of e)if(r==="added"){let s=await this.getFileContent(n,"HEAD"),a=this.analyzeNewFile(n,s);a&&i.push(a)}else if(r==="deleted"){let s=await this.getFileContent(n,t),a=this.analyzeDeletedFile(n,s);a&&i.push(a)}else if(r==="modified"){let s=await this.getFileContent(n,t),a=await this.getFileContent(n,"HEAD"),o=this.analyzeModifiedFile(n,s,a);o&&i.push(o)}return i}async getFileContent(e,t){try{return this.gitHelper.getFileContent(t,e)}catch{return""}}analyzeNewFile(e,t){let i=this.extractComponentInfo(e),n=this.parseFileContent(e,"",t);return{file:e,componentType:i.type,componentName:i.name,changeType:"added",changes:n}}analyzeDeletedFile(e,t){let i=this.extractComponentInfo(e),n=this.parseFileContent(e,t,"");return{file:e,componentType:i.type,componentName:i.name,changeType:"deleted",changes:n}}analyzeModifiedFile(e,t,i){let n=this.extractComponentInfo(e),r=this.parseFileContent(e,t,i);return Object.keys(r).length===0?null:{file:e,componentType:n.type,componentName:n.name,changeType:"modified",changes:r}}parseFileContent(e,t,i){let n={};return e.endsWith(".twig")?Object.assign(n,this.compareTwigFeatures(t,i)):e.endsWith(".ts")||e.endsWith(".js")?Object.assign(n,this.compareTypescriptFeatures(t,i)):(e.endsWith(".scss")||e.endsWith(".css"))&&Object.assign(n,this.compareScssFeatures(t,i)),n}compareTwigFeatures(e,t){let i=e?this.twigParser.parse(e):this.emptyTwigFeatures(),n=t?this.twigParser.parse(t):this.emptyTwigFeatures();return{addedDataAttributes:this.diff(n.dataAttributes,i.dataAttributes),removedDataAttributes:this.diff(i.dataAttributes,n.dataAttributes),addedBlocks:this.diff(n.blocks,i.blocks),removedBlocks:this.diff(i.blocks,n.blocks),addedIncludes:this.diff(n.includes,i.includes),removedIncludes:this.diff(i.includes,n.includes),addedMacros:this.diff(n.macros,i.macros),removedMacros:this.diff(i.macros,n.macros),addedDefineDataVariables:this.diff(n.defineDataVariables,i.defineDataVariables),removedDefineDataVariables:this.diff(i.defineDataVariables,n.defineDataVariables),addedAttributesKeys:this.diff(n.attributesKeys,i.attributesKeys),removedAttributesKeys:this.diff(i.attributesKeys,n.attributesKeys),addedMolecules:this.diff(n.molecules,i.molecules),removedMolecules:this.diff(i.molecules,n.molecules),addedWidgets:this.diff(n.widgets,i.widgets),removedWidgets:this.diff(i.widgets,n.widgets)}}compareTypescriptFeatures(e,t){let i=e?this.typescriptParser.parse(e):this.emptyTypescriptFeatures(),n=t?this.typescriptParser.parse(t):this.emptyTypescriptFeatures(),r=this.detectVisibilityChanges(i.methods,n.methods);return{addedMethods:this.diffMethods(n.methods,i.methods),removedMethods:this.diffMethods(i.methods,n.methods),addedEvents:this.diff(n.events,i.events),removedEvents:this.diff(i.events,n.events),visibilityChanges:r.length>0?r:void 0}}compareScssFeatures(e,t){let i=e?this.scssParser.parse(e):this.emptyScssFeatures(),n=t?this.scssParser.parse(t):this.emptyScssFeatures();return{addedMixins:this.diff(n.mixins,i.mixins),removedMixins:this.diff(i.mixins,n.mixins),addedVariables:this.diff(n.variables,i.variables),removedVariables:this.diff(i.variables,n.variables),addedCssVariables:this.diff(n.cssVariables,i.cssVariables),removedCssVariables:this.diff(i.cssVariables,n.cssVariables),addedClasses:this.diff(n.classes,i.classes),removedClasses:this.diff(i.classes,n.classes),addedModifiers:this.diff(n.modifiers,i.modifiers),removedModifiers:this.diff(i.modifiers,n.modifiers)}}extractComponentInfo(e){let t=e.match(/components\/atoms\/([\w-]+)/);if(t)return{type:"atom",name:t[1]};let i=e.match(/components\/molecules\/([\w-]+)/);if(i)return{type:"molecule",name:i[1]};let n=e.match(/components\/organisms\/([\w-]+)/);if(n)return{type:"organism",name:n[1]};let r=e.match(/templates\/([\w-]+)/);if(r)return{type:"template",name:r[1]};let s=e.match(/pages\/([\w-]+)/);return s?{type:"page",name:s[1]}:e.includes("/styles/")?{type:"style",name:e.split("/").pop()?.replace(/\.(scss|css)$/,"")||"unknown"}:e.endsWith(".ts")||e.endsWith(".js")?{type:"script",name:e.split("/").pop()?.replace(/\.(ts|js)$/,"")||"unknown"}:{type:"unknown",name:e.split("/").pop()||"unknown"}}diff(e,t){let i=e.filter(n=>!t.includes(n));return i.length>0?i:void 0}diffMethods(e,t){let i=e.filter(n=>!t.some(r=>r.name===n.name));return i.length>0?i:void 0}detectVisibilityChanges(e,t){let i=[];for(let n of e){let r=t.find(s=>s.name===n.name);r&&r.visibility!==n.visibility&&i.push({name:n.name,from:n.visibility,to:r.visibility})}return i}emptyTwigFeatures(){return{dataAttributes:[],includes:[],blocks:[],variables:[],macros:[],defineDataVariables:[],attributesKeys:[],molecules:[],widgets:[]}}emptyTypescriptFeatures(){return{classes:[],methods:[],properties:[],events:[]}}emptyScssFeatures(){return{variables:[],cssVariables:[],mixins:[],classes:[],modifiers:[]}}};$();H();ie();var mt=class{constructor(e,t,i,n,r){this.baseCommit=t;this.gitHelper=new et(e,r),this.fileFilter=new tt(i),this.phpParser=new nt,this.transferAnalyzer=new it(this.gitHelper),this.methodAnalyzer=new rt(this.phpParser,e),this.schemaAnalyzer=new st(this.gitHelper),this.composerAnalyzer=new at(this.gitHelper),this.constantAnalyzer=new ot(this.gitHelper),this.frontendAnalyzer=new pt(this.gitHelper)}async analyze(){let e=this.gitHelper.getMergeBase(this.baseCommit),t=this.gitHelper.getAllChangedFiles(e),i=this.createEmptyResult();i.nonPhpFiles=this.fileFilter.identifyNonPhpFiles(t,s=>this.gitHelper.mapGitStatusToChangeType(s)),i.transferChanges=await this.transferAnalyzer.analyzeTransferChanges(t,e),i.schemaChanges=await this.schemaAnalyzer.analyzeSchemaChanges(t,e),i.composerChanges=await this.composerAnalyzer.analyzeComposerChanges(t,e),i.constantChanges=await this.constantAnalyzer.analyzeConstantChanges(t,e);let n=i.nonPhpFiles.filter(s=>s.file.endsWith(".twig")||s.file.endsWith(".ts")||s.file.endsWith(".js")||s.file.endsWith(".scss")||s.file.endsWith(".css"));i.frontendChanges=await this.frontendAnalyzer.analyzeFrontendChanges(n,e);let r=this.fileFilter.filterPhpFilesWithStatus(t);return this.analyzePhpFiles(r,e,i),i}createEmptyResult(){return{newMethods:[],modifiedMethods:[],removedMethods:[],newClasses:[],deprecatedClasses:[],skippedFiles:[],nonPhpFiles:[],transferChanges:[],modifiedFiles:[],schemaChanges:[],composerChanges:[],constantChanges:[],frontendChanges:[]}}analyzePhpFiles(e,t,i){for(let n of e)this.analyzePhpFile(n.file,n.status,t,i)}analyzePhpFile(e,t,i,n){try{if(t===k.ADDED){n.newClasses.push({name:"",fqcn:"",file:e});return}let r=this.gitHelper.getFileDiff(i,e);if(!r||r.trim()===""){n.skippedFiles.push(this.createSkippedFileForEmptyDiff(e));return}this.detectClassDeprecation(e,r,n);let s=this.methodAnalyzer.analyzeDiff(e,r);this.mergeAnalysisResults(s,n),this.trackModifiedFile(e,s,n)}catch(r){n.skippedFiles.push(this.createSkippedFileForError(e,r))}}detectClassDeprecation(e,t,i){if(!/^\+\s*\*\s*@deprecated/m.test(t))return;let r=/^[+ ]?\s*class\s+(\w+)/m,s=t.match(r);if(!s)return;let a=s[1],o=this.phpParser.buildFQCN(e,a);i.deprecatedClasses.push({name:a,fqcn:o,file:e})}trackModifiedFile(e,t,i){if(t.newMethods.length>0||t.modifiedMethods.length>0){let n=this.phpParser.extractClassNameFromFilePath(e);if(n){let r=this.phpParser.buildFQCN(e,n),s=this.extractLayer(e),a=t.modifiedMethods.some(o=>o.signatureChanged)?"signature":"implementation";i.modifiedFiles.push({file:e,className:n,fqcn:r,layer:s,changeType:a})}}}extractLayer(e){let t=le,i=z;for(let n of i)if(e.includes(`/${n}/`))return n;for(let n of t)if(e.includes(`/${n}/`))return n;return"Unknown"}createSkippedFileForEmptyDiff(e){return{file:e,reason:E.skipReasons.emptyDiff,suggestion:"File may have only whitespace changes or be renamed without content changes"}}createSkippedFileForError(e,t){return{file:e,reason:t.message||E.skipReasons.unknownError,error:t.stack,suggestion:"Review this file manually or check if it has syntax errors"}}mergeAnalysisResults(e,t){t.newMethods.push(...e.newMethods),t.modifiedMethods.push(...e.modifiedMethods),t.removedMethods.push(...e.removedMethods),t.newClasses.push(...e.newClasses),t.deprecatedClasses.push(...e.deprecatedClasses),t.skippedFiles.push(...e.skippedFiles)}};X();R();$();$();var v=class{static isPlugin(e){return ne.PLUGIN.test(e)}static isConfig(e){return/Config$/.test(e)||/DependencyProvider$/.test(e)}static isPublicApiClass(e){let t=te.join("|");return new RegExp(`(${t})$`).test(e)?!0:new RegExp(`(${t})Interface$`).test(e)}static isPublicApi(e){let t=e.fqcn.split("::")[0];return e.visibility!=="public"?!1:this.isPublicApiClass(t)||this.isPlugin(t)}static extractModuleName(e){let t=xe.join("|"),i=le.join("|"),n=new RegExp(`\\\\(?:${t})\\\\(${i})\\\\([^\\\\]+)`),r=e.match(n);return r?r[2]:"Unknown"}static isInternalApiLayer(e){let t=z.join("|");return new RegExp(`\\\\(${t})\\\\`).test(e)}};Se();$();he();X();W();$();var ce=class{recommend(e){let t=[],i=!1,n=[];if(e.modifiedPublicAPI.length>0&&t.push({type:"MAJOR",category:"Modified Public API",description:"Public API method signatures changed (breaking)",count:e.modifiedPublicAPI.length}),e.removedMethods.length>0){let d=e.removedMethods.filter(u=>te.some(A=>u.fqcn.includes(A)));d.length>0&&t.push({type:"MAJOR",category:"Removed Public API",description:"Public API methods removed",count:d.length})}let r=e.schemaChanges.filter(d=>d.changeType===h.REMOVED||d.removedColumns&&d.removedColumns.length>0||d.removedIndexes&&d.removedIndexes.length>0);if(r.length>0){let d=r.reduce((u,A)=>u+(A.removedColumns?.length||0),0);(d>0||r.some(u=>u.changeType===h.REMOVED))&&t.push({type:"MAJOR",category:"Database Breaking Changes",description:"Database columns/tables removed",count:d+r.filter(u=>u.changeType===h.REMOVED).length})}let s=e.transferChanges.filter(d=>d.changeType===h.REMOVED||d.removedProperties&&d.removedProperties.length>0);if(s.length>0){let d=s.reduce((u,A)=>u+(A.removedProperties?.length||0),0);t.push({type:"MAJOR",category:"Transfer Breaking Changes",description:"Transfer objects/properties removed",count:d+s.filter(u=>u.changeType===h.REMOVED).length})}if(e.modifiedConfigMethods.length>0){let d=e.modifiedConfigMethods.filter(u=>u.signatureChanged);d.length>0&&t.push({type:"MAJOR",category:"Configuration Breaking Changes",description:"Configuration method signatures changed",count:d.length})}let a=e.constantChanges.filter(d=>d.removedConstants&&d.removedConstants.length>0);if(a.length>0){let d=a.reduce((u,A)=>u+(A.removedConstants?.length||0),0);t.push({type:"MAJOR",category:"Constant Breaking Changes",description:"Constants removed",count:d})}e.newPublicAPI.length>0&&t.push({type:"MINOR",category:"New Public API",description:"New public API methods added",count:e.newPublicAPI.length}),e.newConfigMethods.length>0&&t.push({type:"MINOR",category:"New Configuration",description:"New configuration methods added",count:e.newConfigMethods.length}),e.newClasses.length>0&&t.push({type:"MINOR",category:"New Classes",description:"New classes added",count:e.newClasses.length});let o=e.schemaChanges.filter(d=>d.changeType===h.NEW||d.addedColumns&&d.addedColumns.length>0||d.addedIndexes&&d.addedIndexes.length>0);if(o.length>0){let d=o.reduce((u,A)=>u+(A.addedColumns?.length||0),0);t.push({type:"MINOR",category:"Database Enhancements",description:"New database columns/tables added",count:d+o.filter(u=>u.changeType===h.NEW).length})}let c=e.transferChanges.filter(d=>d.changeType===h.NEW||d.addedProperties&&d.addedProperties.length>0);if(c.length>0){let d=c.reduce((u,A)=>u+(A.addedProperties?.length||0),0);t.push({type:"MINOR",category:"Transfer Enhancements",description:"New transfer objects/properties added",count:d+c.filter(u=>u.changeType===h.NEW).length})}let l=e.newMethods?.filter(d=>d.fqcn.split("::")[0].includes("Plugin"))||[];l.length>0&&t.push({type:"MINOR",category:"New Plugin Methods",description:"New methods added to plugins",count:l.length}),e.internalChangesWithImpact.length>0&&(t.push({type:"MINOR",category:"Internal Changes with Impact",description:"Internal changes affecting public API behavior",count:e.internalChangesWithImpact.length}),i=!0,n.push("Internal changes may affect public API behavior - review for potential breaking changes")),e.internalChangesNoImpact.length>0&&t.length===0&&t.push({type:"PATCH",category:"Internal Improvements",description:"Internal implementation changes with no public API impact",count:e.internalChangesNoImpact.length});let m=t.some(d=>d.type===L.MAJOR),C=t.some(d=>d.type===L.MINOR),f,x;if(m?(f="MAJOR",x=i?"medium":"high"):C?(f="MINOR",x=i?"medium":"high"):(f="PATCH",x=t.length>0?"high":"low",t.length===0&&n.push("No significant changes detected - verify this is intentional")),e.modifiedInternalFiles&&e.modifiedInternalFiles.length>0){let d=e.modifiedInternalFiles.filter(u=>u.changeType===Ee.SIGNATURE).length;d>0&&n.push(`${d} internal file(s) have signature changes - may indicate refactoring`)}return e.nonPhpFiles.length>0&&(e.nonPhpFiles.filter(A=>A.file.includes(b.COMPOSER_JSON)).length>0&&(i=!0,n.push("Composer.json changes detected - review for dependency constraint changes (may require MAJOR)")),e.nonPhpFiles.filter(A=>A.file.includes(b.CONFIG_FILE)||A.file.includes(".yml")||A.file.includes(".yaml")).length>0&&n.push("Configuration file changes detected - review for breaking changes")),{recommendedBump:f,reasons:t,confidence:x,requiresManualReview:i,notes:n}}};he();X();var ft=class{generate(e){let t=[];for(let i of e)t.push(...this.generateEntriesForChange(i));return t}generateEntriesForChange(e){let t=[],i=this.formatComponentReference(e.componentName,e.componentType);return e.changeType==="added"?t.push(...this.generateAddedComponentEntries(e,i)):e.changeType==="deleted"?t.push(...this.generateDeletedComponentEntries(e,i)):e.changeType==="modified"&&t.push(...this.generateModifiedComponentEntries(e,i)),t}generateAddedComponentEntries(e,t){let i=[];return(e.componentType==="atom"||e.componentType==="molecule"||e.componentType==="organism")&&i.push({type:"improvement",category:"component",description:`Introduced ${t}.`,component:e.componentName}),i}generateDeletedComponentEntries(e,t){let i=[];return(e.componentType==="atom"||e.componentType==="molecule"||e.componentType==="organism")&&i.push({type:"breaking",category:"component",description:`Removed ${t}.`,component:e.componentName}),i}generateModifiedComponentEntries(e,t){let i=[],n=e.changes;if(n.addedDataAttributes)for(let r of n.addedDataAttributes)i.push({type:"improvement",category:"data-attribute",description:`Introduced \`${r}\` attribute to ${t}.`,component:e.componentName});if(n.removedDataAttributes)for(let r of n.removedDataAttributes)i.push({type:"breaking",category:"data-attribute",description:`Removed \`${r}\` attribute from ${t}.`,component:e.componentName});if(n.addedBlocks)for(let r of n.addedBlocks)i.push({type:"improvement",category:"block",description:`Introduced \`${r}\` block to ${t}.`,component:e.componentName});if(n.removedBlocks)for(let r of n.removedBlocks)i.push({type:"breaking",category:"block",description:`Removed \`${r}\` block from ${t}.`,component:e.componentName});if(n.addedMacros)for(let r of n.addedMacros)i.push({type:"improvement",category:"macro",description:`Introduced \`${r}\` macro to ${t}.`,component:e.componentName});if(n.removedMacros)for(let r of n.removedMacros)i.push({type:"breaking",category:"macro",description:`Removed \`${r}\` macro from ${t}.`,component:e.componentName});if(n.addedDefineDataVariables)for(let r of n.addedDefineDataVariables)i.push({type:"improvement",category:"variable",description:`Introduced \`${r}\` variable to ${t}.`,component:e.componentName});if(n.removedDefineDataVariables)for(let r of n.removedDefineDataVariables)i.push({type:"breaking",category:"variable",description:`Removed \`${r}\` variable from ${t}.`,component:e.componentName});if(n.addedAttributesKeys)for(let r of n.addedAttributesKeys)i.push({type:"improvement",category:"attribute",description:`Introduced \`${r}\` attribute to ${t}.`,component:e.componentName});if(n.removedAttributesKeys)for(let r of n.removedAttributesKeys)i.push({type:"breaking",category:"attribute",description:`Removed \`${r}\` attribute from ${t}.`,component:e.componentName});if(n.addedMolecules)for(let r of n.addedMolecules)i.push({type:"improvement",category:"molecule",description:`Introduced \`${r}\` molecule usage in ${t}.`,component:e.componentName});if(n.removedMolecules)for(let r of n.removedMolecules)i.push({type:"breaking",category:"molecule",description:`Removed \`${r}\` molecule usage from ${t}.`,component:e.componentName});if(n.addedWidgets)for(let r of n.addedWidgets)i.push({type:"improvement",category:"widget",description:`Introduced \`${r}\` widget to ${t}.`,component:e.componentName});if(n.removedWidgets)for(let r of n.removedWidgets)i.push({type:"breaking",category:"widget",description:`Removed \`${r}\` widget from ${t}.`,component:e.componentName});if(n.addedMethods)for(let r of n.addedMethods)i.push({type:"improvement",category:"method",description:`Introduced \`${r.name}()\` method to ${t}.`,component:e.componentName});if(n.removedMethods)for(let r of n.removedMethods)i.push({type:"breaking",category:"method",description:`Removed \`${r.name}()\` method from ${t}.`,component:e.componentName});if(n.visibilityChanges)for(let r of n.visibilityChanges)r.from==="public"&&(r.to==="protected"||r.to==="private")?i.push({type:"breaking",category:"visibility",description:`Changed \`${r.name}()\` method to ${r.to} in ${t}.`,component:r.name}):(r.from==="protected"||r.from==="private")&&r.to==="public"&&i.push({type:"improvement",category:"visibility",description:`Changed \`${r.name}()\` method to public in ${t}.`,component:r.name});if(n.addedEvents)for(let r of n.addedEvents)i.push({type:"improvement",category:"event",description:`Introduced \`${r}\` event to ${t}.`,component:e.componentName});if(n.removedEvents)for(let r of n.removedEvents)i.push({type:"breaking",category:"event",description:`Removed \`${r}\` event from ${t}.`,component:e.componentName});if(n.addedMixins)for(let r of n.addedMixins)i.push({type:"improvement",category:"mixin",description:`Introduced \`${r}\` mixin to ${t}.`,component:e.componentName});if(n.removedMixins)for(let r of n.removedMixins)i.push({type:"breaking",category:"mixin",description:`Removed \`${r}\` mixin from ${t}.`,component:e.componentName});if(n.addedVariables||n.addedCssVariables){let r=[...n.addedVariables||[],...n.addedCssVariables||[]];for(let s of r)i.push({type:"improvement",category:"variable",description:`Introduced \`${s}\` global SASS variable.`,component:e.componentName})}if(n.removedVariables||n.removedCssVariables){let r=[...n.removedVariables||[],...n.removedCssVariables||[]];for(let s of r)i.push({type:"breaking",category:"variable",description:`Removed \`${s}\` global SASS variable.`,component:e.componentName})}if(n.addedModifiers)for(let r of n.addedModifiers)i.push({type:"improvement",category:"modifier",description:`Introduced \`${r}\` modifier to ${t}.`,component:e.componentName});if(n.removedModifiers)for(let r of n.removedModifiers)i.push({type:"breaking",category:"modifier",description:`Removed \`${r}\` modifier from ${t}.`,component:e.componentName});if(n.addedClasses)for(let r of n.addedClasses)i.push({type:"improvement",category:"class",description:`Introduced \`${r}\` global CSS class.`,component:e.componentName});if(n.removedClasses)for(let r of n.removedClasses)i.push({type:"breaking",category:"class",description:`Removed \`${r}\` global CSS class.`,component:e.componentName});return i}formatComponentReference(e,t){return t==="atom"?`\`${e}\` atom`:t==="molecule"?`\`${e}\` molecule`:t==="organism"?`\`${e}\` organism`:t==="template"?`\`${e}\` template`:t==="page"?`\`${e}\` page`:`\`${e}\``}};var ht=class{constructor(){this.versionRecommender=new ce,this.frontendChangelogGenerator=new ft}generateModuleReports(e){let t=new Map,i=this.groupChangesByModule(e);for(let[n,r]of i.entries()){let s=this.generateModuleReport(n,r,e);t.set(n,s)}return t}groupChangesByModule(e){let t=new Map,i=n=>(t.has(n)||t.set(n,{newPublicAPI:[],modifiedPublicAPI:[],removedPublicAPI:[],affectedPublicAPI:[],newPlugins:[],newPluginClasses:[],deprecatedPluginClasses:[],modifiedPlugins:[],removedPlugins:[],affectedPlugins:[],newConfig:[],modifiedConfig:[],removedConfig:[],communicationAdjustments:[],constants:[],newMethods:[],modifiedMethods:[],modifiedFiles:[],transfers:[],schemas:[],composerChange:null,frontendFiles:[],detailedFrontendChanges:[]}),t.get(n));for(let n of e.newClasses||[])if(v.isPlugin(n.name)){let r=this.extractModuleFromPath(n.file);i(r).newPluginClasses.push(n)}for(let n of e.deprecatedClasses||[])if(v.isPlugin(n.name)){let r=this.extractModuleFromPath(n.file);i(r).deprecatedPluginClasses.push(n)}for(let n of e.newPublicAPI){let r=v.extractModuleName(n.method),s=n.method.split("::")[0];v.isPlugin(s)?i(r).newPlugins.push(n):i(r).newPublicAPI.push(n)}for(let n of e.modifiedPublicAPI){let r=v.extractModuleName(n.method),s=n.method.split("::")[0];v.isPlugin(s)?i(r).modifiedPlugins.push(n):i(r).modifiedPublicAPI.push(n)}for(let n of e.newConfigMethods){let r=v.extractModuleName(n.method);i(r).newConfig.push(n)}for(let n of e.modifiedConfigMethods){let r=v.extractModuleName(n.method);i(r).modifiedConfig.push(n)}for(let n of e.modifiedCommunicationLayer){let r=v.extractModuleName(n.method);i(r).communicationAdjustments.push(n)}for(let n of e.removedMethods){let r=v.extractModuleName(n.fqcn),s=n.fqcn.split("::")[0];v.isPublicApi(n)&&(v.isPlugin(s)?i(r).removedPlugins.push(n):v.isConfig(s)?i(r).removedConfig.push(n):i(r).removedPublicAPI.push(n))}for(let n of e.internalChangesWithImpact)for(let r of n.affectedMethods){let s=v.extractModuleName(`${r.class}::${r.method}`),a=i(s),c=v.isPlugin(r.class)?a.affectedPlugins:a.affectedPublicAPI,l=c.find(m=>m.method===`${r.class}::${r.method}`);l?l.affectedBy.push({internalMethod:n.method,hops:r.hops}):c.push({method:`${r.class}::${r.method}`,affectedBy:[{internalMethod:n.method,hops:r.hops}],description:r.description,isApiMethod:r.isApiMethod,isDeprecated:r.isDeprecated})}if(e.newMethods)for(let n of e.newMethods){let r=v.extractModuleName(n.fqcn),s=n.fqcn.split("::")[0];v.isPlugin(s)?n.visibility==="public"&&i(r).newPlugins.push({method:n.fqcn,file:n.file,visibility:n.visibility}):i(r).newMethods.push(n)}if(e.modifiedMethods)for(let n of e.modifiedMethods){let r=v.extractModuleName(n.fqcn),s=n.fqcn.split("::")[0];v.isPlugin(s)?n.visibility==="public"&&i(r).modifiedPlugins.push({method:n.fqcn,file:n.file,signatureChanged:n.signatureChanged}):i(r).modifiedMethods.push(n)}if(e.modifiedInternalFiles)for(let n of e.modifiedInternalFiles){let r=v.extractModuleName(n.fqcn);i(r).modifiedFiles.push(n)}for(let n of e.transferChanges){let r=this.extractModuleFromPath(n.file);i(r).transfers.push(n)}for(let n of e.schemaChanges){let r=this.extractModuleFromPath(n.file);i(r).schemas.push(n)}for(let n of e.composerChanges){let r=this.extractModuleFromPath(n.file);i(r).composerChange=n}for(let n of e.constantChanges){let r=this.extractModuleFromPath(n.file);i(r).constants.push(n)}for(let n of e.nonPhpFiles)if(this.isFrontendFile(n.file)){let r=this.extractModuleFromPath(n.file);i(r).frontendFiles.push(n)}for(let n of e.frontendChanges){let r=this.extractModuleFromPath(n.file);i(r).detailedFrontendChanges.push(n)}return t}generateModuleReport(e,t,i){let n={...i,newPublicAPI:t.newPublicAPI,modifiedPublicAPI:t.modifiedPublicAPI,removedMethods:t.removedPublicAPI,internalChangesWithImpact:t.affectedPublicAPI.map(d=>({method:d.method,file:"",affectedMethods:d.affectedBy})),transferChanges:t.transfers,schemaChanges:t.schemas,modifiedInternalFiles:t.modifiedFiles,constantChanges:t.constants},r=this.versionRecommender.recommend(n),s={newMethods:this.deduplicateByMethodName(t.newPublicAPI.map(d=>({method:d.method,file:d.file,visibility:d.visibility,description:d.description,isApiMethod:d.isApiMethod,isDeprecated:d.isDeprecated}))),modifiedMethods:this.deduplicateByMethodName(t.modifiedPublicAPI.map(d=>({method:d.method,file:d.file,signatureChanged:d.signatureChanged,description:d.description,isApiMethod:d.isApiMethod,isDeprecated:d.isDeprecated}))),removedMethods:this.deduplicateByMethodName(t.removedPublicAPI.map(d=>({method:d.fqcn,file:d.file,description:d.description,isApiMethod:d.isApiMethod,isDeprecated:d.isDeprecated}))),affectedByInternal:t.affectedPublicAPI.map(d=>({method:d.method,affectedBy:d.affectedBy,description:d.description,isApiMethod:d.isApiMethod,isDeprecated:d.isDeprecated}))},a={newPlugins:this.deduplicateByMethodName(t.newPlugins.map(d=>({method:d.method,file:d.file,visibility:d.visibility}))),newPluginClasses:t.newPluginClasses||[],deprecatedPluginClasses:t.deprecatedPluginClasses||[],modifiedPlugins:this.deduplicateByMethodName(t.modifiedPlugins.map(d=>({method:d.method,file:d.file,signatureChanged:d.signatureChanged}))),removedPlugins:this.deduplicateByMethodName(t.removedPlugins.map(d=>({method:d.fqcn,file:d.file}))),affectedByInternal:t.affectedPlugins.map(d=>({method:d.method,affectedBy:d.affectedBy}))},o={newMethods:t.newConfig.map(d=>({method:d.method,file:d.file,visibility:d.visibility})),modifiedMethods:t.modifiedConfig.map(d=>({method:d.method,file:d.file,signatureChanged:d.signatureChanged})),removedMethods:t.removedConfig.map(d=>({method:d.fqcn,file:d.file}))},c={adjustedMethods:t.communicationAdjustments.map(d=>({method:d.method,file:d.file,signatureChanged:d.signatureChanged,description:d.description}))},l={addedConstants:(t.constants||[]).filter(d=>d.addedConstants&&d.addedConstants.length>0).flatMap(d=>d.addedConstants.map(u=>({name:u.name,className:d.className,value:u.value,visibility:u.visibility}))),removedConstants:(t.constants||[]).filter(d=>d.removedConstants&&d.removedConstants.length>0).flatMap(d=>d.removedConstants.map(u=>({name:u.name,className:d.className,value:u.value,visibility:u.visibility,isConfigOrConstants:d.isConfigOrConstants}))),modifiedConstants:(t.constants||[]).filter(d=>d.modifiedConstants&&d.modifiedConstants.length>0).flatMap(d=>d.modifiedConstants.map(u=>({name:u.name,className:d.className,oldValue:u.oldValue,newValue:u.newValue,visibility:u.visibility})))},m={modifiedMethods:t.modifiedMethods.map(d=>({method:d.fqcn,file:d.file,signatureChanged:d.signatureChanged})),newMethods:t.newMethods.map(d=>({method:d.fqcn,file:d.file})),modifiedFiles:t.modifiedFiles},C={transfers:t.transfers.map(d=>({name:d.transferName,changeType:d.changeType,addedProperties:d.addedProperties,removedProperties:d.removedProperties,modifiedProperties:d.modifiedProperties,strictAdded:d.strictAdded,strictAddedForProperties:d.strictAddedForProperties})),schemas:t.schemas.map(d=>({tableName:d.tableName,changeType:d.changeType,addedColumns:d.addedColumns,removedColumns:d.removedColumns,modifiedColumns:d.modifiedColumns,addedIndexes:d.addedIndexes,removedIndexes:d.removedIndexes}))},f={totalMethodChanges:t.newMethods.length+t.modifiedMethods.length,totalFileChanges:t.modifiedFiles.length,hasBreakingChanges:r.recommendedBump===L.MAJOR,requiresManualReview:r.requiresManualReview,notes:r.notes},x=this.generateFrontendChanges(t.detailedFrontendChanges);return{moduleName:e,versionRecommendation:r,publicApiChanges:s,pluginChanges:a,configChanges:o,communicationChanges:c,constantChanges:l,internalChanges:m,dataChanges:C,frontendChanges:x||void 0,composerChanges:t.composerChange?this.parseComposerChanges(t.composerChange):void 0,validationInfo:f}}parseComposerChanges(e){return e}isFrontendFile(e){return e.endsWith(P.TWIG)||e.endsWith(P.JS)||e.endsWith(P.TS)||e.endsWith(P.SCSS)||e.endsWith(P.CSS)}generateFrontendChanges(e){return e.length===0?null:{detailedChanges:e.map(i=>{let n=this.frontendChangelogGenerator.generate([i]),r=n.filter(o=>o.type==="breaking").map(o=>o.description),s=n.filter(o=>o.type==="improvement").map(o=>o.description),a=n.filter(o=>o.type==="fix").map(o=>o.description);return{file:i.file,componentType:i.componentType,componentName:i.componentName,changeType:i.changeType,breakingChanges:r,improvements:s,fixes:a}})}}extractModuleFromPath(e){let t=e.match(/Bundles\/([^\/]+)/);if(t)return t[1];let i=e.match(/Features\/([^\/]+)/);return i?i[1]:"Unknown"}deduplicateByMethodName(e){let t=new Map;for(let i of e){let n=i.method.split("::")[1];t.has(n)?i.method.includes(b.INTERFACE_SUFFIX)&&t.set(n,i):t.set(n,i)}return Array.from(t.values())}};$();var ut=class{constructor(){this.versionRecommender=new ce,this.moduleReportGenerator=new ht}generateReport(e,t){let i=[],n=[],r=[],s=[],a=[],o=[],c=[];for(let f of e.newMethods)this.isConfigMethod(f)?r.push({method:f.fqcn,file:f.file,visibility:f.visibility}):v.isPublicApi(f)&&i.push({method:f.fqcn,file:f.file,visibility:f.visibility,description:f.description,isApiMethod:f.isApiMethod,isDeprecated:f.isDeprecated});for(let f of e.modifiedMethods)if(this.isConfigMethod(f))s.push({method:f.fqcn,file:f.file,visibility:f.visibility,signatureChanged:f.signatureChanged});else if(this.isCommunicationLayerAdjustment(f))a.push({method:f.fqcn,file:f.file,visibility:f.visibility,signatureChanged:f.signatureChanged});else if(v.isPublicApi(f)){n.push({method:f.fqcn,file:f.file,visibility:f.visibility,signatureChanged:f.signatureChanged,description:f.description,isApiMethod:f.isApiMethod,isDeprecated:f.isDeprecated});let[x,d]=f.fqcn.split("::"),u=x&&d?N(x,d):f.fqcn.toLowerCase(),A=t.get(u)||t.get(f.fqcn)||t.get(f.fqcn.toLowerCase())||[];A.length>0&&o.push({method:f.fqcn,file:f.file,affectedMethods:A})}else{let[x,d]=f.fqcn.split("::"),u=x&&d?N(x,d):f.fqcn.toLowerCase(),A=t.get(u)||t.get(f.fqcn)||t.get(f.fqcn.toLowerCase())||[];A.length>0?o.push({method:f.fqcn,file:f.file,affectedMethods:A}):c.push(f)}let l={newMethods:e.newMethods.length,modifiedMethods:e.modifiedMethods.length,removedMethods:e.removedMethods.length,newClasses:e.newClasses.length,newPublicAPI:i.length,modifiedPublicAPI:n.length,newConfigMethods:r.length,modifiedConfigMethods:s.length,internalWithImpact:o.length,internalNoImpact:c.length},m=this.calculateRiskLevel(n.length,i.length,s.length,o.length),C={timestamp:new Date().toISOString(),riskLevel:m,versionRecommendation:{},moduleReports:new Map,summary:l,newPublicAPI:i,modifiedPublicAPI:n,newConfigMethods:r,modifiedConfigMethods:s,modifiedCommunicationLayer:a,internalChangesWithImpact:o,internalChangesNoImpact:c,removedMethods:e.removedMethods,newClasses:e.newClasses,deprecatedClasses:e.deprecatedClasses||[],skippedFiles:e.skippedFiles,nonPhpFiles:e.nonPhpFiles,transferChanges:e.transferChanges,schemaChanges:e.schemaChanges,composerChanges:e.composerChanges,constantChanges:e.constantChanges,frontendChanges:e.frontendChanges,newMethods:e.newMethods,modifiedMethods:e.modifiedMethods,modifiedInternalFiles:e.modifiedFiles};return C.versionRecommendation=this.versionRecommender.recommend(C),C.moduleReports=this.moduleReportGenerator.generateModuleReports(C),C}isConfigMethod(e){return e.visibility!=="public"?!1:/\\Config(::|$)/.test(e.fqcn)||e.file.includes(b.CONFIG)}isCommunicationLayerAdjustment(e){if(e.visibility==="private")return!1;let t=z.find(o=>o==="Communication");if(!e.file.includes(`/${t}/`))return!1;let n=e.fqcn.split("::")[0].split(ee.NAMESPACE).pop()||"",r=U.CONTROLLER,s=U.FORM,a=U.TABLE;return n.endsWith(r)||n.endsWith(s)||n.endsWith(a)}calculateRiskLevel(e,t,i,n){return e>0||i>G.MODIFIED_CONFIG_METHODS_HIGH?O.HIGH:t>G.NEW_PUBLIC_API_MEDIUM||n>G.INTERNAL_WITH_IMPACT_MEDIUM||i>0?O.MEDIUM:O.LOW}};$();var _t=class{constructor(e){this.modulePatterns=e||De}async analyze(e){let t=e.modulePatterns||this.modulePatterns,{effectiveRoot:i,moduleFilter:n}=this.detectModuleScope(e.root,t),r=this.createLogger(e.debug),s=await this.analyzeDiff({...e,root:i},r),{impactResults:a,symbolIndex:o}=await this.analyzeImpact(i,s,n,t,r);return this.enrichDiffWithPhpDoc(s,o),{diffResult:s,impactResults:a}}enrichDiffWithPhpDoc(e,t){let{canonKey:i}=(R(),Rt(Dt)),n=t.methods||t;for(let r of[...e.newMethods,...e.modifiedMethods]){let s=null;if(r.fqcn&&r.name){let a=i(r.fqcn.split("::")[0],r.name);s=n.get(a)}if(!s&&r.file&&r.start){for(let[a,o]of n.entries())if(o.file===r.file&&o.start===r.start){s=o,r.fqcn=`${o.classFQN}::${o.name}`,r.name=o.name;break}}s&&(r.description=s.description,r.isApiMethod=s.isApiMethod,r.isDeprecated=s.isDeprecated,r.visibility=s.visibility)}if(t.classes){for(let r of e.newClasses||[])if(r.file){for(let[s,a]of t.classes.entries())if(a.file.endsWith(r.file)||r.file.endsWith(a.file)){r.fqcn=s,r.name=s.split(ee.NAMESPACE).pop()||"";break}}}}async generateReport(e,t,i){let n=i||this.modulePatterns,{moduleFilter:r}=this.detectModuleScope(t,n),a=new ut().generateReport(e.diffResult,e.impactResults);return r?this.filterReportByModule(a,r):a}async analyzeDiff(e,t){return await new mt(e.root,e.diff,e.includeTests||!1,t,e.modules).analyze()}async analyzeImpact(e,t,i,n,r){let s=new Map,a=null,o=this.groupMethodsByModule(t),c=this.getAllModulesWithChanges(t);for(let l of c){if(i&&l!==i)continue;let m=o.get(l)||[],C=await this.analyzeModuleImpact(e,l,m,n,s,r);C&&!a&&(a=C)}return{impactResults:s,symbolIndex:a||{classes:new Map,methods:new Map}}}getAllModulesWithChanges(e){let t=new Set;for(let i of[...e.newMethods,...e.modifiedMethods]){let n=v.extractModuleName(i.fqcn);t.add(n)}return t}groupMethodsByModule(e){let t=new Map;for(let i of e.modifiedMethods){if(v.isPublicApi(i))continue;let n=v.extractModuleName(i.fqcn);this.addMethodToModule(t,n,i)}for(let i of e.modifiedFiles){let n=v.extractModuleName(i.fqcn),r=this.createFileMethod(i);this.addMethodToModule(t,n,r)}return t}addMethodToModule(e,t,i){e.has(t)||e.set(t,[]),e.get(t).push(i)}createFileMethod(e){return{name:"*",class:e.className,fqcn:`${e.fqcn}::*`,file:e.file,visibility:"public",signatureChanged:!1}}async analyzeModuleImpact(e,t,i,n,r,s){let a=this.buildModuleGlobs(t,n),o=i.map(c=>c.fqcn);try{let l=await new Ze({root:e,globs:a,excludes:[],targets:o,entrypointRegex:new RegExp(Re(),"i"),linkInterfaces:!0,debug:!1,logger:s}).analyze();for(let m of Object.keys(l.impacted)){let C=l.impacted[m]||[];C.length>0&&r.set(m,C)}return l.symbolIndex||null}catch(c){return s(`[Warning] Could not analyze module ${t}: ${c.message}`),null}}buildModuleGlobs(e,t){return t.map(i=>i.glob.replace("{module}",e))}filterReportByModule(e,t){let i=new Map,n=e.moduleReports;n instanceof Map&&n.has(t)&&i.set(t,n.get(t));let r=new RegExp(`\\\\${t}\\\\`),s=C=>C.filter(f=>{let x=f.method||f.fqcn||"";return r.test(x)}),a=s(e.newPublicAPI||[]),o=s(e.modifiedPublicAPI||[]),c=s(e.newConfigMethods||[]),l=s(e.modifiedConfigMethods||[]),m=s(e.internalChangesWithImpact||[]);return{...e,moduleReports:i,newPublicAPI:a,modifiedPublicAPI:o,newConfigMethods:c,modifiedConfigMethods:l,internalChangesWithImpact:m,summary:{...e.summary,newPublicAPI:a.length,modifiedPublicAPI:o.length,newConfigMethods:c.length,modifiedConfigMethods:l.length,internalWithImpact:m.length}}}detectModuleScope(e,t){for(let i of t){if(!e.includes(i.detect))continue;let n=e.split(i.detect),r=n[0],s=n[1];if(!s)continue;let a=s.split("/")[0];if(a)return{effectiveRoot:r,moduleFilter:a}}return{effectiveRoot:e}}createLogger(e){return e?(...t)=>{console.error("[DEBUG]",...t)}:()=>{}}};export{Ce as a,Rt as b,Re as c,$ as d,Ze as e,_t as f,Xt as g,Jt as h};
